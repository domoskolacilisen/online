<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domoškola Líšeň - CMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif; }
        
        /* BARVY KARET */
        .card-modra { background-color: #eff6ff; border-color: #bfdbfe; }
        .card-zelena { background-color: #ecfdf5; border-color: #a7f3d0; }
        .card-cervena { background-color: #fef2f2; border-color: #fecaca; }
        .card-zluta { background-color: #fefce8; border-color: #fef08a; }
        .card-fialova { background-color: #faf5ff; border-color: #e9d5ff; }
        .card-oranzova { background-color: #fff7ed; border-color: #fed7aa; }
        .card-seda { background-color: #f8fafc; border-color: #e2e8f0; }
        /* Nové barvy */
        .card-ruzova { background-color: #fdf2f8; border-color: #fbcfe8; }
        .card-tyrkys { background-color: #ecfeff; border-color: #a5f3fc; }
        .card-limeta { background-color: #f7fee7; border-color: #d9f99d; }
        .card-hneda { background-color: #fafaf9; border-color: #e7e5e4; }
        .card-cerna { background-color: #f1f5f9; border-color: #cbd5e1; }


        /* BARVY TLAČÍTEK */
        .btn-modra { background-color: #2563eb !important; }
        .btn-zelena { background-color: #059669 !important; }
        .btn-cervena { background-color: #dc2626 !important; }
        .btn-zluta { background-color: #ca8a04 !important; }
        .btn-fialova { background-color: #7c3aed !important; }
        .btn-oranzova { background-color: #ea580c !important; }
        .btn-seda { background-color: #475569 !important; }
        /* Nové barvy tlačítek */
        .btn-ruzova { background-color: #db2777 !important; }
        .btn-tyrkys { background-color: #0891b2 !important; }
        .btn-limeta { background-color: #65a30d !important; }
        .btn-hneda { background-color: #57534e !important; }
        .btn-cerna { background-color: #0f172a !important; }
        
        /* HOTOVÉ ÚKOLY (STUDENT) & NEAKTIVNÍ (ADMIN) */
        .card-done, .card-inactive { 
            background-color: #f8fafc; /* slate-50 */
            border-color: #e2e8f0; /* slate-200 */
        }
        
        /* Ztmavení textů uvnitř šedé karty */
        .card-done h3, .card-inactive h3 { color: #64748b !important; /* slate-500 */ }
        .card-done p, .card-inactive p { color: #94a3b8 !important; /* slate-400 */ }
        
        /* Tlačítko 'Otevřít' v hotové kartě zešedne */
        .card-done .action-btn, .card-inactive .action-btn {
            background-color: #cbd5e1 !important; /* slate-300 */
            pointer-events: auto; 
        }

        /* Hover efekt pro datum a status v hotové kartě */
        .card-done:hover .done-info {
            color: #059669 !important; /* emerald-600 */
            transition: color 0.3s ease;
        }

        /* ANIMACE */
        .animate-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-overlay { background-color: rgba(0, 0, 0, 0.4); backdrop-filter: blur(8px); }
        
        .custom-checkbox { width: 22px; height: 22px; border-radius: 6px; border: 2px solid #cbd5e1; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .custom-checkbox.checked { background-color: #2563eb; border-color: #2563eb; color: white; }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.300.0"
      }
    }
    </script>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Search, PlusCircle, FileText, Video, Trash2, Edit3, X, 
            LogOut, Loader2, Save, Filter, Settings, Key, User,
            School, CheckCircle, Check, Layers, UploadCloud, Bell,
            UserCircle, LayoutGrid, FileCheck, Lock, Globe, Users,
            ArrowLeft, FileOutput, ChevronDown, Eye, EyeOff, CheckSquare, Square, UserPlus,
            ToggleLeft, ToggleRight, Tag, Link, ExternalLink, Calendar
        } from 'lucide-react';

        // --- KONFIGURACE ---
        const DEFAULT_API_URL = "https://script.google.com/macros/s/AKfycbwYrc9z4UmbZ8JKYK8Gtr03ukacuA51weoGhUtAEYjv5y1ilLWpwwIslilhy3NnnWAgCw/exec";
        const GENERAL_INFO_LABEL = "Obecné informace";
        const ITEMS_PER_PAGE = 9;

        const ConfirmModal = ({ show, title, message, onConfirm, onCancel }) => {
            if (!show) return null;
            return React.createElement('div', { className: "fixed inset-0 z-[100] flex items-center justify-center p-6 modal-overlay", onClick: onCancel },
                React.createElement('div', { className: "bg-white rounded-[2rem] shadow-2xl w-full max-w-sm p-8 animate-in relative flex flex-col items-center text-center", onClick: e => e.stopPropagation() },
                    React.createElement('div', { className: "w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mb-4" }, React.createElement(Trash2, { size: 32 })),
                    React.createElement('h3', { className: "text-xl font-bold text-slate-800 mb-2" }, title || "Opravdu smazat?"),
                    React.createElement('p', { className: "text-slate-500 text-sm mb-8" }, message || "Tato akce je nevratná."),
                    React.createElement('div', { className: "flex gap-4 w-full" },
                        React.createElement('button', { onClick: onCancel, className: "flex-1 py-3 bg-slate-100 text-slate-500 font-bold uppercase text-xs rounded-xl hover:bg-slate-200 transition-colors" }, "Zrušit"),
                        React.createElement('button', { onClick: onConfirm, className: "flex-1 py-3 bg-red-600 text-white font-bold uppercase text-xs rounded-xl hover:bg-red-700 transition-colors" }, "Smazat")
                    )
                )
            );
        };

        const Timeline = () => {
             const [todayPos, setTodayPos] = useState({ sem: 0, pos: 0 }); // sem: 1, 2, 3 (holiday), pos: %

             useEffect(() => {
                 const now = new Date();
                 const month = now.getMonth(); // 0 = Jan
                 const day = now.getDate();
                 
                 // Semester 1: Sep(8) - Jan(0). Total 5 months.
                 // Order: Sep, Oct, Nov, Dec, Jan
                 if ([8, 9, 10, 11, 0].includes(month)) {
                     const semMonthIndices = [8, 9, 10, 11, 0];
                     const idx = semMonthIndices.indexOf(month);
                     const daysInMonth = new Date(now.getFullYear(), month + 1, 0).getDate();
                     const progress = (idx + (day / daysInMonth)) / 5;
                     setTodayPos({ sem: 1, pos: progress * 100 });
                 } 
                 // Semester 2: Feb(1) - Jun(5). Total 5 months.
                 // Order: Feb, Mar, Apr, May, Jun
                 else if ([1, 2, 3, 4, 5].includes(month)) {
                     const idx = month - 1; // Feb(1) -> 0
                     const daysInMonth = new Date(now.getFullYear(), month + 1, 0).getDate();
                     const progress = (idx + (day / daysInMonth)) / 5;
                     setTodayPos({ sem: 2, pos: progress * 100 });
                 } 
                 // Holiday: Jul(6), Aug(7). Total 2 months.
                 else {
                     const idx = month - 6; // Jul(6) -> 0
                     const daysInMonth = new Date(now.getFullYear(), month + 1, 0).getDate();
                     const progress = (idx + (day / daysInMonth)) / 2;
                     setTodayPos({ sem: 3, pos: progress * 100 });
                 }
             }, []);

             const months1 = ["zář", "říj", "lis", "pro", "led"];
             const months2 = ["úno", "bře", "dub", "kvě", "čer"];
             const months3 = ["čvc", "srp"];
             
             return React.createElement('div', { className: "w-full flex items-center h-full px-4" },
                React.createElement('div', { className: "w-full relative flex items-center gap-1" },
                    // 1. Pololetí
                    React.createElement('div', { className: "flex-1 relative" },
                        React.createElement('div', { className: "h-2 bg-blue-100 rounded-l-full relative overflow-hidden" },
                             todayPos.sem === 1 && React.createElement('div', { className: "absolute top-0 bottom-0 bg-blue-200/50 w-full animate-pulse" })
                        ),
                        React.createElement('span', { className: "absolute -top-3 left-2 text-[8px] font-bold text-blue-300 uppercase tracking-wider" }, "1. Pol"),
                        React.createElement('div', { className: "flex justify-between px-2 pt-1" },
                            months1.map((m, i) => React.createElement('span', { key: m, className: "text-[8px] text-slate-400 font-light uppercase" }, m))
                        ),
                        todayPos.sem === 1 && React.createElement('div', { className: "absolute top-1 -translate-y-1/2 w-3 h-3 bg-red-500 rounded-full border-2 border-white shadow-sm z-10 transition-all duration-1000", style: { left: `calc(${todayPos.pos}% - 6px)` }, title: "Dnes" })
                    ),
                    // 2. Pololetí
                    React.createElement('div', { className: "flex-1 relative" },
                        React.createElement('div', { className: "h-2 bg-green-100 relative overflow-hidden" },
                             todayPos.sem === 2 && React.createElement('div', { className: "absolute top-0 bottom-0 bg-green-200/50 w-full animate-pulse" })
                        ),
                        React.createElement('span', { className: "absolute -top-3 left-2 text-[8px] font-bold text-green-300 uppercase tracking-wider" }, "2. Pol"),
                        React.createElement('div', { className: "flex justify-between px-2 pt-1" },
                            months2.map((m, i) => React.createElement('span', { key: m, className: "text-[8px] text-slate-400 font-light uppercase" }, m))
                        ),
                        todayPos.sem === 2 && React.createElement('div', { className: "absolute top-1 -translate-y-1/2 w-3 h-3 bg-red-500 rounded-full border-2 border-white shadow-sm z-10 transition-all duration-1000", style: { left: `calc(${todayPos.pos}% - 6px)` }, title: "Dnes" })
                    ),
                    // Prázdniny
                    React.createElement('div', { className: "w-[16%] relative" },
                        React.createElement('div', { className: "h-2 bg-amber-100 rounded-r-full relative overflow-hidden" },
                             todayPos.sem === 3 && React.createElement('div', { className: "absolute top-0 bottom-0 bg-amber-200/50 w-full animate-pulse" })
                        ),
                        React.createElement('span', { className: "absolute -top-3 left-2 text-[8px] font-bold text-amber-300 uppercase tracking-wider" }, "Prázd"),
                        React.createElement('div', { className: "flex justify-between px-2 pt-1" },
                            months3.map((m, i) => React.createElement('span', { key: m, className: "text-[8px] text-slate-400 font-light uppercase" }, m))
                        ),
                        todayPos.sem === 3 && React.createElement('div', { className: "absolute top-1 -translate-y-1/2 w-3 h-3 bg-red-500 rounded-full border-2 border-white shadow-sm z-10 transition-all duration-1000", style: { left: `calc(${todayPos.pos}% - 6px)` }, title: "Dnes" })
                    )
                )
             );
        };

        const App = () => {
            // --- STATE ---
            const [user, setUser] = useState(null);
            const [data, setData] = useState({ materials: [], config: [], users: [], news: [], progress: [], personalDocs: [] });
            const [loading, setLoading] = useState(false);
            const [loginError, setLoginError] = useState('');
            
            // View States
            const [activeGrade, setActiveGrade] = useState("Vše");
            const [activeSubject, setActiveSubject] = useState("Vše");
            const [searchQuery, setSearchQuery] = useState("");
            const [showFilters, setShowFilters] = useState(false);
            const [viewMode, setViewMode] = useState('portal'); 
            const [visibleItems, setVisibleItems] = useState(ITEMS_PER_PAGE);
            
            // New Filter States
            const [filterType, setFilterType] = useState("Vše");
            const [filterTag, setFilterTag] = useState("Vše");

            const [selectedItems, setSelectedItems] = useState([]);
            const [processingIds, setProcessingIds] = useState([]);
            const [toast, setToast] = useState(null);
            
            const [showUploadModal, setShowUploadModal] = useState(false);
            const [showEditModal, setShowEditModal] = useState(null);
            const [showNewsModal, setShowNewsModal] = useState(false);
            const [showProfileModal, setShowProfileModal] = useState(false);
            
            const [confirmModal, setConfirmModal] = useState({ show: false, title: '', message: '', onConfirm: null });

            // Student Management State
            const [selectedStudent, setSelectedStudent] = useState(null);
            const [showStudentModal, setShowStudentModal] = useState(false);
            const [newStudent, setNewStudent] = useState({ jmeno: '', login: '', pin: '', mojeTrida: '', typStudenta: 'interni', emailRodice: '', vek: '', kmenovaSkola: '' });
            const [studentFilterClass, setStudentFilterClass] = useState("Vše");
            const [hideInactive, setHideInactive] = useState(false);
            
            // Admin Edit Student State
            const [adminStudentData, setAdminStudentData] = useState({ 
                aktivni: 'ano', datumNastupu: '', datumUkonceni: '',
                jmeno: '', login: '', pin: '', mojeTrida: '', typStudenta: 'interni', emailRodice: '', vek: '', kmenovaSkola: ''
            });

            // Login State
            const [loginInput, setLoginInput] = useState('');
            const [pinInput, setPinInput] = useState('');

            // Upload State
            const [uploadFile, setUploadFile] = useState(null);
            const [uploadMeta, setUploadMeta] = useState({ nazev: '', poznamka: '', trida: '', predmet: '', typ: '', tagy: '', cilovaSkupina: 'all', odkazWeb: '', obdobi: '0' });
            const [isUploading, setIsUploading] = useState(false);

            // Edit State
            const [editFile, setEditFile] = useState(null);

            // Upload State (Personal Docs)
            const [personalUploadFile, setPersonalUploadFile] = useState(null);
            const [personalUploadName, setPersonalUploadName] = useState('');
            
            // Config State
            const [configEditItem, setConfigEditItem] = useState(null);
            const [newConfig, setNewConfig] = useState({kategorie: 'Predmet', nazev: '', hodnota: 'seda'});

            // User Profile State
            const [profileConfig, setProfileConfig] = useState({ mojeTrida: '', emailRodice: '', vek: '', kmenovaSkola: '' });
            
            // Current Semester Calc
            const [currentSemester, setCurrentSemester] = useState(() => {
                const month = new Date().getMonth();
                if ([8, 9, 10, 11, 0].includes(month)) return 1;
                if ([1, 2, 3, 4, 5].includes(month)) return 2;
                return 0;
            });


            // --- INIT ---
            useEffect(() => {
                const saved = localStorage.getItem('domoskola_user');
                if (saved) {
                    const parsedUser = JSON.parse(saved);
                    setUser(parsedUser);
                    // OKAMŽITÁ INICIALIZACE FILTRŮ PŘI OBNOVENÍ (OPRAVA CHYBY POLO-APLIKACE)
                    if (parsedUser.typStudenta === 'externi' && parsedUser.mojeTrida) {
                        setActiveGrade(parsedUser.mojeTrida);
                    } else if (parsedUser.mojeTrida) {
                        setActiveGrade(parsedUser.mojeTrida);
                    }
                }
            }, []);

            useEffect(() => {
                if (user) {
                    loadData();
                    setProfileConfig({ 
                        mojeTrida: user.mojeTrida || '', 
                        emailRodice: user.emailRodice || '',
                        vek: user.vek || '',
                        kmenovaSkola: user.kmenovaSkola || ''
                    });
                }
            }, [user]);

            useEffect(() => {
                if (selectedStudent) {
                    setAdminStudentData({
                        aktivni: selectedStudent.aktivni || 'ano',
                        datumNastupu: selectedStudent.datumNastupu || '',
                        datumUkonceni: selectedStudent.datumUkonceni || '',
                        jmeno: selectedStudent.jmeno,
                        login: selectedStudent.login,
                        pin: selectedStudent.pin,
                        mojeTrida: selectedStudent.mojeTrida || '',
                        typStudenta: selectedStudent.typStudenta || 'interni',
                        vek: selectedStudent.vek || '',
                        kmenovaSkola: selectedStudent.kmenovaSkola || '',
                        emailRodice: selectedStudent.emailRodice || ''
                    });
                }
            }, [selectedStudent]);

            useEffect(() => {
                setVisibleItems(ITEMS_PER_PAGE);
            }, [activeGrade, activeSubject, searchQuery, filterType, filterTag]);

            useEffect(() => {
                if (toast) {
                    const timer = setTimeout(() => setToast(null), 3000);
                    return () => clearTimeout(timer);
                }
            }, [toast]);

            const loadData = async () => {
                setLoading(true);
                try {
                    const res = await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'getData' }) });
                    const json = await res.json();
                    if (json.error) throw new Error(json.error);
                    // Default sort by date DESC, logic overridden below for students
                    if (json.materials) json.materials.sort((a, b) => new Date(b.datum).getTime() - new Date(a.datum).getTime());
                    setData(prev => ({
                        ...prev,
                        materials: json.materials || [],
                        users: json.users || [],
                        config: json.config || [],
                        news: json.news || [],
                        progress: json.progress || [],
                        personalDocs: json.personalDocs || []
                    }));
                } catch (e) { 
                    console.error(e);
                    setToast({ msg: "Chyba načítání dat", type: "error" });
                } 
                finally { setLoading(false); }
            };

            // --- HANDLERS ---
            const handleLogout = () => {
                localStorage.removeItem('domoskola_user');
                window.location.reload();
            };
            
            const showToast = (msg, type = 'success') => setToast({ msg, type });

            const openConfirm = (title, message, onConfirm) => {
                setConfirmModal({ show: true, title, message, onConfirm: () => { onConfirm(); setConfirmModal({ show: false, title: '', message: '', onConfirm: null }); } });
            };

            const handleLogin = (e) => {
                e.preventDefault();
                setLoginError('');
                setLoading(true);
                fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'getData' }) })
                    .then(r => r.json())
                    .then(json => {
                        const usersList = json.users || [];
                        const found = usersList.find(u => 
                            u.login.toLowerCase().trim() === loginInput.toLowerCase().trim() && 
                            String(u.pin).trim() === String(pinInput).trim()
                        );
                        if (found && (found.aktivni === 'ano' || found.aktivni === 'aktivni')) {
                            const userData = { ...found, role: found.role === 'admin' ? 'admin' : 'user', typStudenta: found.typStudenta || 'interni' };
                            setUser(userData);
                            localStorage.setItem('domoskola_user', JSON.stringify(userData));
                            setData({
                                materials: json.materials || [],
                                users: json.users || [],
                                config: json.config || [],
                                news: json.news || [],
                                progress: json.progress || [],
                                personalDocs: json.personalDocs || []
                            });
                            // DŮLEŽITÉ: Nastavit třídu ihned po přihlášení
                            if (found.mojeTrida) setActiveGrade(found.mojeTrida);
                        } else { setLoginError("Neplatné přihlašovací jméno nebo PIN."); }
                    })
                    .catch((err) => { console.error(err); setLoginError("Chyba připojení k databázi."); })
                    .finally(() => setLoading(false));
            };

            const handleProfileSave = async (e) => {
                e.preventDefault();
                setLoading(true);
                const updatedUser = { ...user, ...profileConfig };
                try {
                    await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'updateUserConfig', login: user.login, ...profileConfig }) });
                    setUser(updatedUser);
                    localStorage.setItem('domoskola_user', JSON.stringify(updatedUser));
                    
                    setShowProfileModal(false);
                    showToast("Profil aktualizován");
                    if (profileConfig.mojeTrida) setActiveGrade(profileConfig.mojeTrida);
                } catch (err) { showToast("Chyba ukládání: " + err, 'error'); } 
                finally { setLoading(false); }
            };

            const handleCreateStudent = async (e) => {
                e.preventDefault();
                if(!newStudent.login || !newStudent.pin || !newStudent.jmeno) return showToast("Vyplňte povinná pole (Jméno, Login, PIN)", 'error');
                
                setLoading(true);
                try {
                    const res = await fetch(DEFAULT_API_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ action: 'createUser', user: newStudent }) 
                    });
                    const json = await res.json();
                    if(json.error) throw new Error(json.error);
                    
                    showToast("Žák úspěšně vytvořen");
                    setShowStudentModal(false);
                    setNewStudent({ jmeno: '', login: '', pin: '', mojeTrida: '', typStudenta: 'interni', emailRodice: '', vek: '', kmenovaSkola: '' });
                    loadData();
                } catch(err) {
                    showToast("Chyba: " + err.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleUpdateStudentDetails = async () => {
                if(!selectedStudent) return;
                setLoading(true);
                try {
                    const res = await fetch(DEFAULT_API_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ action: 'updateStudentAdmin', login: selectedStudent.login, ...adminStudentData }) 
                    });
                    const json = await res.json();
                    if(json.error) throw new Error(json.error);
                    
                    showToast("Údaje uloženy");
                    const updatedUser = { ...selectedStudent, ...adminStudentData };
                    setSelectedStudent(updatedUser);
                    setData(prev => ({
                        ...prev,
                        users: prev.users.map(u => u.login === updatedUser.login ? updatedUser : u)
                    }));
                } catch(err) {
                    showToast("Chyba: " + err.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleToggleProgress = async (materialId) => {
                const mIdStr = String(materialId);
                const isDone = data.progress.some(p => p.userLogin === user.login && String(p.materialId) === mIdStr);
                
                let newProgress = [];
                if (isDone) {
                    newProgress = data.progress.filter(p => !(p.userLogin === user.login && String(p.materialId) === mIdStr));
                } else {
                    newProgress = [...data.progress, { userLogin: user.login, materialId: materialId, datum: new Date().toISOString() }];
                }
                setData(prev => ({ ...prev, progress: newProgress }));
                try { await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'toggleProgress', login: user.login, materialId: materialId }) }); } catch(e) {}
            };

            const handleDeletePersonalDoc = (e, docId) => {
                e.stopPropagation();
                openConfirm("Smazat dokument?", "Opravdu chcete smazat tento osobní dokument?", async () => {
                    setData(prev => ({
                        ...prev,
                        personalDocs: prev.personalDocs.filter(d => d.id !== docId)
                    }));

                    try {
                        await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'deletePersonalDoc', id: docId }) });
                        showToast("Dokument smazán");
                    } catch(err) {
                        showToast("Chyba mazání: " + err, 'error');
                        loadData();
                    }
                });
            };

            const handleUploadSubmit = async (e) => {
                e.preventDefault();
                if (!uploadFile && !uploadMeta.odkazWeb) return showToast("Vyberte soubor nebo zadejte odkaz", 'error');
                setIsUploading(true);
                
                const finalUploadMeta = { ...uploadMeta };
                if (uploadMeta.trida === GENERAL_INFO_LABEL) {
                    finalUploadMeta.predmet = "Info"; 
                    finalUploadMeta.typ = "Dokument"; 
                }
                
                const processUpload = async (base64String = null, mimeType = null, filename = null) => {
                     try {
                        await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({
                            action: 'upload', 
                            filename, 
                            mimeType, 
                            base64: base64String, 
                            ...finalUploadMeta
                        }) });
                        showToast("Materiál úspěšně nahrán");
                        setShowUploadModal(false);
                        setUploadFile(null);
                        setUploadMeta({ nazev: '', poznamka: '', trida: '', predmet: '', typ: '', tagy: '', cilovaSkupina: 'all', odkazWeb: '', obdobi: '0' });
                        loadData();
                    } catch (err) { showToast("Chyba nahrávání: " + err, 'error'); } 
                    finally { setIsUploading(false); }
                };

                if (uploadFile) {
                    const reader = new FileReader();
                    reader.onload = () => processUpload(reader.result.split(',')[1], uploadFile.type, uploadFile.name);
                    reader.readAsDataURL(uploadFile);
                } else {
                    processUpload();
                }
            };
            
            const handlePersonalUpload = async (e) => {
                e.preventDefault();
                if (!personalUploadFile || !selectedStudent) return showToast("Chyba", 'error');
                setIsUploading(true);
                const reader = new FileReader();
                reader.onload = async () => {
                    const base64String = reader.result.split(',')[1];
                    try {
                        await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({
                            action: 'uploadPersonal', 
                            userLogin: selectedStudent.login,
                            nazev: personalUploadName,
                            filename: personalUploadFile.name, 
                            mimeType: personalUploadFile.type, 
                            base64: base64String
                        }) });
                        showToast("Hodnocení nahráno");
                        setPersonalUploadFile(null);
                        setPersonalUploadName('');
                        loadData(); 
                    } catch (err) { showToast("Chyba nahrávání: " + err, 'error'); } 
                    finally { setIsUploading(false); }
                };
                reader.readAsDataURL(personalUploadFile);
            };

            const handleAction = async (action, ids, extraData = {}) => {
                setProcessingIds(prev => [...prev, ...ids]);
                if (action === 'updateStatus') {
                    setData(prev => ({ ...prev, materials: prev.materials.map(m => ids.includes(m.id) ? {...m, status: m.status === 'publikovano' ? 'neaktivni' : 'publikovano'} : m) }));
                } else if (action === 'edit') {
                    setData(prev => ({ ...prev, materials: prev.materials.map(m => m.id === extraData.id ? {...m, ...extraData} : m) }));
                    setShowEditModal(null);
                    setEditFile(null);
                }
                try {
                    await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action, ids, ...extraData }) });
                    showToast("Změny uloženy");
                } catch (e) { showToast("Chyba akce", 'error'); } 
                finally { setProcessingIds(prev => prev.filter(pid => !ids.includes(pid))); }
            };

            const handleEditSubmit = async (e) => {
                e.preventDefault();
                let extraData = { id: showEditModal.id, ...showEditModal };
                
                if (editFile) {
                    setIsUploading(true);
                    const reader = new FileReader();
                    reader.onload = async () => {
                        const base64String = reader.result.split(',')[1];
                        extraData = { 
                            ...extraData, 
                            base64: base64String, 
                            filename: editFile.name, 
                            mimeType: editFile.type 
                        };
                        await handleAction('edit', [], extraData);
                        setIsUploading(false);
                    };
                    reader.readAsDataURL(editFile);
                } else {
                    handleAction('edit', [], extraData);
                }
            };

            const handleConfigSave = async (e) => {
                e.preventDefault();
                const itemToSave = configEditItem || newConfig;
                if (configEditItem) {
                    setData(prev => ({...prev, config: prev.config.map(c => (c.kategorie === configEditItem.kategorie && c.nazev === configEditItem.nazev) ? itemToSave : c)}));
                    setConfigEditItem(null);
                    await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'updateConfig', oldItem: configEditItem, newItem: itemToSave }) });
                } else {
                    setData(prev => ({ ...prev, config: [...prev.config, itemToSave] }));
                    setNewConfig({kategorie: 'Predmet', nazev: '', hodnota: 'seda'});
                    await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'saveConfig', item: itemToSave }) });
                }
                showToast("Nastavení uloženo");
            };

            const handleConfigDelete = (item) => {
                openConfirm("Smazat položku?", `Opravdu smazat ${item.nazev}?`, async () => {
                    setData(prev => ({...prev, config: prev.config.filter(c => c !== item)}));
                    await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'deleteConfig', item }) });
                    showToast("Položka smazána");
                });
            };

            const getCardColor = (predmetName) => {
                const conf = data.config.find(c => c.kategorie === 'Predmet' && c.nazev === predmetName);
                return conf ? conf.hodnota : 'seda';
            };
            
            const getProgressDate = (materialId) => {
                 const p = data.progress.find(p => p.userLogin === user.login && String(p.materialId) === String(materialId));
                 return p ? new Date(p.datum).toLocaleDateString('cs-CZ') : null;
            }

            const isDone = (materialId) => data.progress.some(p => p.userLogin === user.login && String(p.materialId) === String(materialId));
            
            const getSchoolYearLabel = (isoDate) => {
                const d = new Date(isoDate);
                const year = d.getFullYear();
                const month = d.getMonth() + 1; // 1-12
                if (month >= 9) return `${year}/${year + 1}`; // Sep-Dec
                return `${year - 1}/${year}`; // Jan-Aug
            };
            
            const formatDateCZ = (isoString) => {
                if (!isoString) return "-";
                const parts = isoString.split('-');
                if (parts.length !== 3) return isoString;
                return `${parseInt(parts[2])}. ${parseInt(parts[1])}. ${parts[0]}`;
            };
            
            const getObdobiLabel = (val) => {
                if (val == 1) return "1. Pololetí";
                if (val == 2) return "2. Pololetí";
                return "Celoroční";
            };

            const handleHomeClick = () => {
                if (user.mojeTrida) setActiveGrade(user.mojeTrida); else setActiveGrade("Vše");
                setSearchQuery("");
                setFilterType("Vše");
                setFilterTag("Vše");
                setViewMode('portal');
            };

            // --- RENDER ---
            let uniqueGrades = [...data.config.filter(c => c.kategorie === 'Trida').map(c => c.nazev).sort()];
            const uniqueSubjects = ["Vše", ...data.config.filter(c => c.kategorie === 'Predmet').map(c => c.nazev).sort()];
            const uniqueTypes = ["Vše", ...data.config.filter(c => c.kategorie === 'Typ').map(c => c.nazev).sort()];
            
            const configTags = data.config.filter(c => c.kategorie === 'Tag').map(c => c.nazev);
            const usedTags = data.materials.flatMap(m => m.tagy ? m.tagy.split(',').map(t => t.trim()) : []).filter(t => t !== "");
            const allTagsRaw = [...new Set([...configTags, ...usedTags])].sort();
            const uniqueTags = ["Vše", ...allTagsRaw.filter(t => t !== "Vše" && t !== "")];
            
            if (user && user.typStudenta === 'externi') {
                uniqueGrades = user.mojeTrida ? [user.mojeTrida] : [];
            }

            const getFilteredMaterials = () => {
                 return data.materials.filter(m => {
                    if (viewMode === 'portal') {
                        if (user.role !== 'admin' && m.status !== 'publikovano') return false;
                        
                        if (user.typStudenta === 'externi') {
                            if (m.cilovaSkupina === 'interni') return false;
                            if (m.trida !== GENERAL_INFO_LABEL && m.trida !== user.mojeTrida) return false;
                        }
                        
                        if (activeGrade === GENERAL_INFO_LABEL) {
                            if (m.trida !== GENERAL_INFO_LABEL) return false;
                        } else {
                            if (m.trida === GENERAL_INFO_LABEL) return false;
                            if (activeGrade !== "Vše" && m.trida !== activeGrade) return false;
                        }

                        if (activeGrade !== GENERAL_INFO_LABEL) {
                             if (activeSubject !== "Vše" && m.predmet !== activeSubject) return false;
                             if (filterType !== "Vše" && m.typ !== filterType) return false;
                        }
                        
                        if (filterTag !== "Vše") {
                            if (!m.tagy) return false;
                            const mTags = m.tagy.split(',').map(t => t.trim());
                            if (!mTags.includes(filterTag)) return false;
                        }

                        return (m.nazev + m.tagy + m.predmet + (m.poznamka || "")).toLowerCase().includes(searchQuery.toLowerCase());
                    }
                    return true;
                });
            };

            // SORTING LOGIC FIXED HERE
            const filteredMaterials = getFilteredMaterials().sort((a, b) => {
                if (user.role !== 'admin') {
                    // Score function for students
                    const getScore = (m) => {
                        const itemSem = String(m.obdobi || '0');
                        const currSem = String(currentSemester);
                        
                        if (itemSem === currSem) return 3; // Highest priority: Current Semester
                        if (itemSem === '0') return 2;     // Medium priority: Full Year
                        return 1;                          // Low priority: Other semesters
                    };
                    
                    const scoreA = getScore(a);
                    const scoreB = getScore(b);
                    
                    // If scores are different, higher score comes first
                    if (scoreA !== scoreB) {
                        return scoreB - scoreA;
                    }
                }
                // Default: Newest first (Secondary sort)
                return new Date(b.datum).getTime() - new Date(a.datum).getTime();
            });

            const displayedMaterials = viewMode === 'portal' ? filteredMaterials.slice(0, visibleItems) : filteredMaterials;

            // LOGIN SCREEN
            if (!user) {
                return React.createElement('div', { className: "min-h-screen bg-blue-600 flex items-center justify-center p-6 text-slate-900 font-sans" },
                    React.createElement('div', { className: "max-w-md w-full bg-white rounded-[3.5rem] p-12 shadow-2xl animate-in text-center" },
                        React.createElement('div', { className: "bg-blue-50 w-24 h-24 rounded-[2rem] flex items-center justify-center mx-auto mb-8 text-blue-600 shadow-inner" }, React.createElement(School, { size: 48, strokeWidth: 2.5 })),
                        React.createElement('h1', { className: "text-4xl font-black uppercase mb-2 tracking-tight text-blue-900 leading-tight" }, "Domoškola Líšeň"),
                        React.createElement('p', { className: "text-blue-400 font-bold uppercase tracking-widest text-[10px] mb-10" }, "Digitální studovna"),
                        React.createElement('form', { onSubmit: handleLogin, className: "space-y-6" },
                            React.createElement('input', { type: "text", required: true, placeholder: "Přihlašovací jméno", value: loginInput, onChange: e => setLoginInput(e.target.value), className: "w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl text-center outline-none focus:ring-2 focus:ring-blue-600 transition-all placeholder:text-slate-300" }),
                            React.createElement('input', { type: "password", required: true, placeholder: "PIN", value: pinInput, onChange: e => setPinInput(e.target.value), className: "w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl text-center font-mono outline-none focus:ring-2 focus:ring-blue-600 transition-all text-xl placeholder:text-slate-300" }),
                            loginError && React.createElement('p', { className: "text-red-500 text-xs font-bold bg-red-50 p-4 rounded-xl border border-red-100" }, loginError),
                            React.createElement('button', { type: "submit", disabled: loading, className: "w-full bg-blue-600 text-white py-5 rounded-[2rem] font-bold uppercase shadow-xl hover:bg-blue-700 active:scale-95 transition-all flex justify-center items-center gap-2" }, loading ? React.createElement(Loader2, { className: "animate-spin" }) : "Vstoupit")
                        )
                    )
                );
            }

            // APP SCREEN
            return React.createElement('div', { className: "min-h-screen flex flex-col bg-slate-50 text-slate-900 font-sans" },
                // HEADER
                React.createElement('header', { className: "bg-white border-b border-blue-100 sticky top-0 z-40 px-6 py-4 flex items-center justify-between shadow-sm h-20" },
                    React.createElement('button', { onClick: handleHomeClick, className: "flex items-center gap-3 group" },
                        React.createElement('div', { className: "bg-blue-600 p-2.5 rounded-2xl text-white shadow-lg group-hover:scale-105 transition-transform" }, React.createElement(School, { className: "w-6 h-6" })),
                        React.createElement('div', { className: "hidden sm:block text-left leading-none" },
                            React.createElement('h1', { className: "font-bold text-xl text-blue-900 uppercase tracking-tight" }, "Domoškola Líšeň"),
                            React.createElement('p', { className: "text-[9px] text-blue-400 font-bold uppercase tracking-widest leading-tight mt-1" }, "Digitální portál")
                        )
                    ),
                    
                    // TIMELINE MOVED TO HEADER CENTER
                    viewMode === 'portal' && React.createElement('div', { className: "flex-1 max-w-2xl mx-auto h-full hidden md:block" },
                        React.createElement(Timeline)
                    ),

                    React.createElement('div', { className: "flex items-center gap-4 shrink-0" },
                         React.createElement('button', { onClick: () => setShowNewsModal(true), className: "p-3 bg-amber-100 text-amber-600 hover:bg-amber-200 rounded-2xl transition-all relative", title: "Aktuality" },
                            React.createElement(Bell, { className: "w-5 h-5" }),
                            data.news.length > 0 && React.createElement('span', { className: "absolute -top-1 -right-1 bg-red-500 text-white text-[9px] font-bold w-4 h-4 rounded-full flex items-center justify-center shadow-sm" }, data.news.length)
                        ),
                        React.createElement('button', { onClick: () => setShowProfileModal(true), className: "hidden sm:flex items-center gap-3 hover:bg-slate-50 p-2 rounded-2xl transition-colors text-right" },
                            React.createElement('div', { className: "leading-none" },
                                // TUČNÉ JMÉNO - ARIAL BLACK
                                React.createElement('div', { className: "text-lg text-blue-900", style: { fontFamily: "Arial Black, sans-serif", fontWeight: 900 } }, user.jmeno),
                                // NORMÁLNÍ TŘÍDA - MENŠÍ, NORMAL CASE
                                React.createElement('div', { className: "text-xs font-medium text-blue-600 mt-1 flex items-center gap-1 justify-end" }, 
                                    React.createElement(Globe, { size: 10 }), user.mojeTrida || user.typStudenta
                                )
                            ),
                            React.createElement('div', { className: "w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold" }, React.createElement(UserCircle, { size: 28 }))
                        ),
                        React.createElement('button', { onClick: handleLogout, className: "p-3 bg-slate-50 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-2xl transition-all", title: "Odhlásit se" }, React.createElement(LogOut, { className: "w-5 h-5" }))
                    )
                ),
                
                // MAIN CONTAINER
                React.createElement('div', { className: "max-w-7xl mx-auto p-6 flex flex-col md:flex-row gap-8 flex-1 w-full" },
                    // SIDEBAR - STICKY FIXED (Updated top offset)
                    React.createElement('aside', { className: "md:w-60 flex-shrink-0 space-y-4 sticky top-24 pt-4 h-[calc(100vh-6rem)] overflow-y-auto custom-scroll pb-10" },
                        React.createElement('div', { className: "flex flex-col gap-1 bg-white/50 p-2 rounded-[2rem] border border-blue-50 shadow-sm" },
                            React.createElement('h3', { className: "text-[9px] font-black text-blue-200 uppercase tracking-widest py-4 text-center" }, "Ročníky"),
                            user.typStudenta !== 'externi' && React.createElement('button', { onClick: () => { setActiveGrade("Vše"); setViewMode('portal'); }, className: `px-5 py-4 rounded-2xl font-bold text-xs text-left transition-all ${activeGrade === "Vše" && viewMode === 'portal' ? 'bg-blue-600 text-white shadow-xl translate-x-2' : 'text-slate-500 hover:bg-white hover:text-blue-600'}` }, "Vše"),
                            uniqueGrades.length > 0 ? uniqueGrades.map(g => React.createElement('button', { key: g, onClick: () => { setActiveGrade(g); setViewMode('portal'); }, className: `px-5 py-4 rounded-2xl font-bold text-xs text-left transition-all ${activeGrade === g && viewMode === 'portal' ? 'bg-blue-600 text-white shadow-xl translate-x-2' : 'text-slate-500 hover:bg-white hover:text-blue-600'}` }, g)) : React.createElement('div', { className: "text-center text-[10px] text-slate-400 py-4" }, "Žádná třída nenastavena")
                        ),
                        React.createElement('div', { className: "flex flex-col gap-1 bg-white/50 p-2 rounded-[2rem] border border-blue-50 shadow-sm" },
                             React.createElement('h3', { className: "text-[9px] font-black text-blue-200 uppercase tracking-widest py-4 text-center" }, "Informace"),
                             React.createElement('button', { onClick: () => { setActiveGrade(GENERAL_INFO_LABEL); setViewMode('portal'); }, className: `px-5 py-4 rounded-2xl font-bold text-xs text-left transition-all flex items-center gap-2 ${activeGrade === GENERAL_INFO_LABEL ? 'bg-indigo-600 text-white shadow-xl translate-x-2' : 'text-slate-500 hover:bg-white hover:text-indigo-600'}` }, React.createElement(LayoutGrid, { size: 14 }), "Školní materiály")
                        )
                    ),

                    // MAIN CONTENT
                    React.createElement('main', { className: "flex-1 min-w-0" },
                        viewMode === 'portal' && React.createElement('div', { className: "animate-in flex flex-col min-h-[80vh]" },
                            // STICKY HEADER WRAPPER (Updated top offset, added search)
                            React.createElement('div', { className: "sticky top-20 z-20 bg-slate-50 pt-2 pb-2" },
                                React.createElement('div', { className: "flex items-center justify-between mb-2 flex-wrap gap-4" },
                                    React.createElement('h2', { className: "text-2xl font-bold text-blue-900" }, activeGrade === "Vše" ? "Všechny studijní dokumenty" : (activeGrade === GENERAL_INFO_LABEL ? "Obecné školní materiály" : activeGrade)),
                                    
                                    // SEARCH AND ACTIONS GROUP
                                    React.createElement('div', { className: "flex gap-2 items-center flex-wrap" },
                                        // SEARCH INPUT MOVED HERE
                                        React.createElement('div', { className: "relative w-full sm:w-48" },
                                            React.createElement(Search, { className: "absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4" }),
                                            React.createElement('input', { 
                                                type: "text", 
                                                value: searchQuery, 
                                                onChange: e => setSearchQuery(e.target.value), 
                                                placeholder: "Hledat...", 
                                                className: "w-full pl-9 pr-4 py-3 bg-white border border-blue-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-600 text-xs shadow-sm transition-all placeholder:text-slate-400" 
                                            })
                                        ),

                                        user.role === 'admin' && React.createElement(React.Fragment, null,
                                            React.createElement('button', { onClick: () => setViewMode('config'), className: "p-3 bg-white text-blue-600 border border-blue-100 rounded-2xl text-[10px] font-bold uppercase shadow-sm flex items-center gap-2 hover:bg-blue-50 transition-colors" }, React.createElement(Settings, { className: "w-4 h-4" }), " Nastavení"),
                                            React.createElement('button', { onClick: () => { setViewMode('students'); setSelectedStudent(null); }, className: "p-3 bg-purple-100 text-purple-600 border border-purple-200 rounded-2xl text-[10px] font-bold uppercase shadow-sm flex items-center gap-2 hover:bg-purple-200 transition-colors" }, React.createElement(Users, { className: "w-4 h-4" }), " Žáci"),
                                            React.createElement('button', { onClick: () => setShowUploadModal(true), className: "p-3 bg-emerald-600 text-white rounded-2xl text-[10px] font-bold uppercase shadow-lg flex items-center gap-2 hover:bg-emerald-700 transition-colors" }, React.createElement(PlusCircle, { className: "w-4 h-4" }), " Nahrát")
                                        ),
                                        React.createElement('button', { onClick: () => setShowFilters(!showFilters), className: `p-3 rounded-2xl text-[10px] font-bold uppercase transition-all ${showFilters ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-blue-400 border border-blue-100'}` }, "Filtry")
                                    )
                                ),
                                
                                // INLINE FILTERS
                                showFilters && React.createElement('div', { className: "mb-6 animate-in flex flex-wrap gap-4 items-center bg-white p-4 rounded-3xl border border-slate-100 shadow-sm" },
                                    activeGrade !== GENERAL_INFO_LABEL && React.createElement('div', { className: "flex items-center gap-2" },
                                        React.createElement('span', { className: "text-[10px] font-bold uppercase text-slate-400" }, "Typ dokumentu:"),
                                        React.createElement('select', { value: filterType, onChange: e => setFilterType(e.target.value), className: "p-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-blue-600" },
                                            uniqueTypes.map(t => React.createElement('option', { key: t, value: t }, t))
                                        )
                                    ),
                                    React.createElement('div', { className: "flex items-center gap-2" },
                                        React.createElement('span', { className: "text-[10px] font-bold uppercase text-slate-400" }, "Tagy:"),
                                        React.createElement('select', { value: filterTag, onChange: e => setFilterTag(e.target.value), className: "p-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-blue-600" },
                                            uniqueTags.map(t => React.createElement('option', { key: t, value: t }, t))
                                        )
                                    )
                                ),

                                activeGrade !== GENERAL_INFO_LABEL ? React.createElement('div', { className: "flex flex-wrap gap-2 mb-4" },
                                    uniqueSubjects.map(s => React.createElement('button', { key: s, onClick: () => setActiveSubject(s), className: `px-5 py-3 rounded-2xl text-[10px] font-bold uppercase transition-all ${activeSubject === s ? 'bg-blue-600 text-white shadow-md' : 'bg-white text-blue-400 border border-blue-100 hover:bg-blue-50'}` }, s))
                                ) : React.createElement('div', { className: "flex flex-wrap gap-2 mb-4" },
                                    uniqueTags.map(t => React.createElement('button', { key: t, onClick: () => setFilterTag(t), className: `px-5 py-3 rounded-2xl text-[10px] font-bold uppercase transition-all ${filterTag === t ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-indigo-400 border border-indigo-100 hover:bg-indigo-50'}` }, t))
                                )
                            ),
                            
                            // LOADING STATE FOR CONTENT
                            loading && data.materials.length === 0 ? React.createElement('div', { className: "flex flex-col items-center justify-center py-20 opacity-50" },
                                React.createElement(Loader2, { className: "w-12 h-12 text-blue-400 animate-spin mb-4" }),
                                React.createElement('div', { className: "text-slate-400 text-sm font-bold uppercase" }, "Načítám nástěnku...")
                            ) : 
                            
                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-10 pt-4" },
                                displayedMaterials.map(m => {
                                    const isGeneralMaterial = m.trida === GENERAL_INFO_LABEL;
                                    const color = isGeneralMaterial ? 'hneda' : getCardColor(m.predmet);
                                    
                                    const isInactiveForAdmin = user.role === 'admin' && m.status !== 'publikovano';
                                    const done = isDone(m.id);
                                    const doneDate = done ? getProgressDate(m.id) : null;
                                    
                                    const cardClass = isInactiveForAdmin 
                                        ? 'card-inactive' 
                                        : (done ? 'card-done' : `card-${color}`);
                                        
                                    // Visual logic for Semesters
                                    const itemSem = m.obdobi || '0'; // 0, 1, 2
                                    const isCurrentSem = (itemSem == 0) || (itemSem == String(currentSemester));
                                    const btnOpacityClass = isCurrentSem ? '' : 'opacity-40 hover:opacity-100';

                                    return React.createElement('div', { key: m.id, className: `${cardClass} border-2 rounded-[2rem] p-6 hover:shadow-xl transition-all group flex flex-col justify-between relative` },
                                        user.role === 'admin' && React.createElement('div', { className: "absolute top-4 right-4 flex gap-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity" },
                                            React.createElement('button', { onClick: () => setShowEditModal(m), className: "p-2 bg-white/80 text-blue-600 rounded-xl hover:bg-white shadow-sm" }, React.createElement(Edit3, { className: "w-4 h-4" })),
                                            React.createElement('button', { onClick: () => handleAction('updateStatus', [m.id]), className: `p-2 rounded-xl shadow-sm ${m.status === 'publikovano' ? 'bg-white/80 text-emerald-600 hover:bg-red-50 hover:text-red-500' : 'bg-red-100 text-red-500 hover:bg-emerald-50 hover:text-emerald-500'}` }, 
                                                m.status === 'publikovano' ? React.createElement(Eye, { className: "w-4 h-4" }) : React.createElement(EyeOff, { className: "w-4 h-4" })
                                            )
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('div', { className: "flex flex-wrap gap-2 mb-6 items-center" },
                                                isGeneralMaterial ? (
                                                    m.tagy && React.createElement('span', { className: "px-3 py-1 text-[9px] font-bold uppercase rounded-full border border-current opacity-70 font-mono bg-white/50" }, `#${m.tagy}`)
                                                ) : (
                                                    React.createElement(React.Fragment, null,
                                                        React.createElement('span', { className: "px-3 py-1 text-[9px] font-bold uppercase rounded-full border border-current opacity-70 font-mono bg-white/50" }, m.predmet),
                                                        React.createElement('span', { className: "px-3 py-1 text-[9px] font-bold uppercase rounded-full border border-current opacity-70 font-mono bg-white/50" }, m.trida),
                                                        React.createElement('span', { className: "px-3 py-1 text-[9px] font-bold uppercase rounded-full border border-current opacity-70 font-mono bg-white/50" }, m.typ)
                                                    )
                                                ),
                                                // Semester Badge - Improved Contrast
                                                m.obdobi && m.obdobi != '0' && React.createElement('span', { className: "ml-auto px-2 py-0.5 rounded text-[9px] font-bold uppercase bg-white text-slate-500 border border-slate-200 shadow-sm" }, m.obdobi + ". Pol")
                                            ),
                                            React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                                                m.cilovaSkupina === 'interni' && React.createElement('div', { className: "flex items-center gap-1 text-purple-600 font-bold text-[10px] uppercase bg-purple-50 px-2 rounded-full" }, React.createElement(Lock, { size: 10 }), "Interní"),
                                                user.role === 'admin' && m.cilovaSkupina === 'externi' && React.createElement('div', { className: "flex items-center gap-1 text-amber-600 font-bold text-[10px] uppercase bg-amber-50 px-2 rounded-full" }, React.createElement(Lock, { size: 10 }), "Externí"),
                                                user.role === 'admin' && m.cilovaSkupina === 'all' && React.createElement('div', { className: "flex items-center gap-1 text-slate-500 font-bold text-[10px] uppercase bg-slate-100 px-2 rounded-full" }, React.createElement(Globe, { size: 10 }), "Všichni")
                                            ),
                                            React.createElement('h3', { className: "text-xl font-bold text-slate-800 mb-2 leading-tight" }, m.nazev),
                                            React.createElement('p', { className: "text-slate-500 text-sm mb-8 leading-relaxed line-clamp-2" }, m.poznamka)
                                        ),
                                        React.createElement('div', { className: "pt-6 border-t border-white/50 flex flex-col gap-4" },
                                            React.createElement('div', { className: "flex justify-between text-[10px] font-bold text-slate-400 uppercase" },
                                                React.createElement('span', null, new Date(m.datum).toLocaleDateString('cs-CZ')),
                                                user.role === 'admin' ? 
                                                    (m.status !== 'publikovano' && React.createElement('span', { className: "text-red-500 font-bold flex items-center gap-1" }, React.createElement(EyeOff, { size: 12 }), "NEAKTIVNÍ"))
                                                    : (done && React.createElement('span', { className: "done-info flex items-center gap-1" }, React.createElement(CheckCircle, { size: 12 }), "HOTOVO ", doneDate))
                                            ),
                                            React.createElement('div', { className: "flex gap-2 items-stretch" },
                                                // Group links to share width
                                                React.createElement('div', { className: "flex-1 flex gap-2" },
                                                    m.odkaz && React.createElement('a', { href: m.odkaz, target: "_blank", rel: "noreferrer", className: `action-btn flex-1 flex items-center justify-center gap-1.5 text-white py-3 rounded-2xl text-[11px] font-bold uppercase shadow-lg active:scale-95 transition-all btn-${color} ${btnOpacityClass}` }, m.typ.includes('Video') ? React.createElement(Video, { size: 16 }) : React.createElement(FileText, { size: 16 }), " Soubor"),
                                                    m.odkazWeb && React.createElement('a', { href: m.odkazWeb, target: "_blank", rel: "noreferrer", className: `action-btn flex-1 flex items-center justify-center gap-1.5 text-white py-3 rounded-2xl text-[11px] font-bold uppercase shadow-lg active:scale-95 transition-all btn-${color} ${btnOpacityClass}` }, React.createElement(Globe, { size: 16 }), " Web")
                                                ),
                                                // Compact Toggle Button
                                                user.role !== 'admin' && !isGeneralMaterial && React.createElement('button', { 
                                                    onClick: () => handleToggleProgress(m.id), 
                                                    className: `min-w-[4rem] rounded-2xl border-2 flex flex-col items-center justify-center gap-0.5 transition-all ${done ? 'bg-emerald-100 border-emerald-300' : 'bg-white border-slate-200 hover:border-blue-300 group/toggle'}`
                                                }, 
                                                    React.createElement(done ? CheckCircle : Square, { size: 20, className: done ? "text-emerald-600" : "text-slate-300 group-hover/toggle:text-blue-500" }),
                                                    React.createElement('span', { className: `text-[8px] font-bold uppercase ${done ? 'text-emerald-600' : 'text-slate-400 group-hover/toggle:text-blue-500'}` }, done ? "Hotovo" : "Splnit")
                                                )
                                            )
                                        )
                                    );
                                }),
                                filteredMaterials.length === 0 && !loading && React.createElement('div', { className: "col-span-full text-center py-20 text-slate-400" }, "Nic nenalezeno.")
                            ),
                            visibleItems < filteredMaterials.length && React.createElement('div', { className: "flex justify-center pb-20" },
                                React.createElement('button', { onClick: () => setVisibleItems(prev => prev + ITEMS_PER_PAGE), className: "px-8 py-4 bg-white border border-blue-200 text-blue-600 font-bold uppercase text-xs rounded-[2rem] shadow-lg hover:bg-blue-50 transition-all flex items-center gap-2" },
                                    "Načíst další materiály", React.createElement(ChevronDown, { size: 16 })
                                )
                            )
                        ),
                        // STUDENTS MANAGEMENT VIEW
                        viewMode === 'students' && React.createElement('div', { className: "animate-in h-full flex flex-col" },
                             React.createElement('div', { className: "flex flex-col gap-4 mb-8" },
                                React.createElement('div', { className: "flex items-center justify-between" },
                                    React.createElement('div', { className: "flex items-center gap-4" },
                                        React.createElement('h2', { className: "text-3xl font-bold text-blue-900 uppercase flex items-center gap-3" },
                                            selectedStudent ? React.createElement(React.Fragment, null, React.createElement('button', { onClick: () => setSelectedStudent(null), className: "p-2 bg-white rounded-xl hover:bg-slate-100" }, React.createElement(ArrowLeft, { size: 24 })), selectedStudent.jmeno) : "Správa žáků"
                                        )
                                    ),
                                    React.createElement('button', { onClick: () => setViewMode('portal'), className: "p-3 bg-slate-200 rounded-xl hover:bg-slate-300 transition-colors" }, React.createElement(X, { className: "w-5 h-5" }))
                                ),
                                !selectedStudent && React.createElement('div', { className: "flex items-center gap-4 flex-wrap" }, 
                                    React.createElement('button', { onClick: () => setShowStudentModal(true), className: "px-4 py-3 bg-blue-600 text-white rounded-xl text-[10px] font-bold uppercase shadow-lg hover:bg-blue-700 transition-all flex items-center gap-2" }, React.createElement(UserPlus, { size: 16 }), "Přidat žáka"),
                                    React.createElement('select', { value: studentFilterClass, onChange: e => setStudentFilterClass(e.target.value), className: "p-2 bg-white border border-blue-200 rounded-xl text-xs font-bold uppercase text-blue-600 outline-none" },
                                        React.createElement('option', { value: "Vše" }, "Všechny třídy"),
                                        uniqueGrades.map(g => React.createElement('option', { key: g, value: g }, g))
                                    ),
                                    React.createElement('label', { className: "flex items-center gap-2 cursor-pointer ml-2" },
                                        React.createElement('input', { type: "checkbox", checked: hideInactive, onChange: e => setHideInactive(e.target.checked), className: "w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" }),
                                        React.createElement('span', { className: "text-[10px] font-bold uppercase text-slate-500" }, "Skrýt neaktivní")
                                    )
                                )
                            ),
                            !selectedStudent ? (
                                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
                                    data.users
                                    .filter(u => u.role !== 'admin' && (studentFilterClass === "Vše" || u.mojeTrida === studentFilterClass) && (!hideInactive || u.aktivni === 'ano'))
                                    .sort((a, b) => {
                                        // 1. Aktivní první
                                        const aActive = a.aktivni === 'ano';
                                        const bActive = b.aktivni === 'ano';
                                        if (aActive && !bActive) return -1;
                                        if (!aActive && bActive) return 1;

                                        // 2. Věk (číslo) - od nejmladšího (menší číslo)
                                        const aAge = parseInt(a.vek) || 999;
                                        const bAge = parseInt(b.vek) || 999;
                                        if (aAge !== bAge) return aAge - bAge;

                                        // 3. Třída
                                        if ((a.mojeTrida || "") < (b.mojeTrida || "")) return -1;
                                        if ((a.mojeTrida || "") > (b.mojeTrida || "")) return 1;

                                        return a.jmeno.localeCompare(b.jmeno);
                                    })
                                    .map(u => {
                                        const isActive = u.aktivni === 'ano';
                                        return React.createElement('button', { key: u.login, onClick: () => setSelectedStudent(u), className: `bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 hover:shadow-lg hover:border-blue-200 transition-all text-left flex items-center gap-4 ${!isActive ? 'opacity-60 grayscale bg-slate-50' : ''}` },
                                            React.createElement('div', { className: `w-12 h-12 rounded-full flex items-center justify-center font-bold ${isActive ? 'bg-blue-50 text-blue-600' : 'bg-slate-200 text-slate-500'}` }, u.jmeno.charAt(0)),
                                            React.createElement('div', null,
                                                React.createElement('div', { className: "font-bold text-slate-800" }, u.jmeno),
                                                React.createElement('div', { className: "text-xs text-slate-400 font-mono" }, u.login),
                                                React.createElement('div', { className: "text-xs text-slate-500 mt-1 font-bold" }, 
                                                    u.mojeTrida ? `Třída: ${u.mojeTrida}` : '', 
                                                    u.mojeTrida && u.vek ? ' • ' : '', 
                                                    u.vek ? `Věk: ${u.vek}` : ''
                                                ),
                                                u.datumNastupu && React.createElement('div', { className: "text-[11px] text-slate-400 font-mono mt-1" }, `Nástup: ${formatDateCZ(u.datumNastupu)}`)
                                            ),
                                            React.createElement('div', { className: "ml-auto" }, 
                                                !isActive ? React.createElement(EyeOff, { size: 16, className: "text-slate-400" }) :
                                                (u.typStudenta === 'externi' ? React.createElement(Lock, { size: 16, className: "text-amber-400" }) : React.createElement(Globe, { size: 16, className: "text-purple-400" }))
                                            )
                                        );
                                    })
                                )
                            ) : (
                                React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-8" },
                                    React.createElement('div', { className: "space-y-6" },
                                        React.createElement('div', { className: "bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm" },
                                            React.createElement('h3', { className: "font-bold text-blue-900 uppercase text-xs mb-4" }, "Informace o žákovi"),
                                            React.createElement('div', { className: "grid grid-cols-2 gap-4 text-sm" },
                                                React.createElement('div', null, 
                                                    React.createElement('div', { className: "text-slate-500 text-[10px] font-bold uppercase mb-1" }, "Login (read-only)"), 
                                                    React.createElement('div', { className: "font-mono text-slate-800 p-2 bg-slate-50 rounded-xl" }, adminStudentData.login)
                                                ),
                                                React.createElement('div', null, 
                                                    React.createElement('label', { className: "text-slate-500 text-[10px] font-bold uppercase mb-1 block" }, "PIN"), 
                                                    React.createElement('input', { value: adminStudentData.pin, onChange: e => setAdminStudentData({...adminStudentData, pin: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl" })
                                                ),
                                                React.createElement('div', null, 
                                                    React.createElement('label', { className: "text-slate-500 text-[10px] font-bold uppercase mb-1 block" }, "Třída"), 
                                                    React.createElement('select', { value: adminStudentData.mojeTrida, onChange: e => setAdminStudentData({...adminStudentData, mojeTrida: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl" },
                                                        React.createElement('option', { value: "" }, "Vybrat..."),
                                                        uniqueGrades.map(g => React.createElement('option', { key: g, value: g }, g))
                                                    )
                                                ),
                                                React.createElement('div', null, 
                                                    React.createElement('label', { className: "text-slate-500 text-[10px] font-bold uppercase mb-1 block" }, "Typ"), 
                                                    React.createElement('select', { value: adminStudentData.typStudenta, onChange: e => setAdminStudentData({...adminStudentData, typStudenta: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl" },
                                                        React.createElement('option', { value: "interni" }, "Interní"),
                                                        React.createElement('option', { value: "externi" }, "Externí")
                                                    )
                                                ),
                                                React.createElement('div', null, 
                                                    React.createElement('label', { className: "text-slate-500 text-[10px] font-bold uppercase mb-1 block" }, "Věk"), 
                                                    React.createElement('input', { type: "number", value: adminStudentData.vek, onChange: e => setAdminStudentData({...adminStudentData, vek: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl" })
                                                ),
                                                React.createElement('div', null, 
                                                    React.createElement('label', { className: "text-slate-500 text-[10px] font-bold uppercase mb-1 block" }, "Kmenová škola"), 
                                                    React.createElement('input', { value: adminStudentData.kmenovaSkola, onChange: e => setAdminStudentData({...adminStudentData, kmenovaSkola: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl" })
                                                ),
                                                React.createElement('div', { className: "col-span-2" }, 
                                                    React.createElement('label', { className: "text-slate-500 text-[10px] font-bold uppercase mb-1 block" }, "Email rodiče"), 
                                                    React.createElement('input', { type: "email", value: adminStudentData.emailRodice, onChange: e => setAdminStudentData({...adminStudentData, emailRodice: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl" })
                                                ),
                                            )
                                        ),
                                        React.createElement('div', { className: "bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm" },
                                            React.createElement('h3', { className: "font-bold text-slate-500 uppercase text-xs mb-4" }, "Administrativní údaje"),
                                            React.createElement('div', { className: "space-y-4" },
                                                React.createElement('div', { className: "flex items-center gap-4" },
                                                    React.createElement('div', { className: "text-[10px] font-bold uppercase text-slate-400 w-24" }, "Stav účtu"),
                                                    React.createElement('button', { onClick: () => setAdminStudentData({...adminStudentData, aktivni: adminStudentData.aktivni === 'ano' ? 'ne' : 'ano'}), className: `flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold uppercase transition-colors ${adminStudentData.aktivni === 'ano' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}` }, 
                                                        adminStudentData.aktivni === 'ano' ? React.createElement(ToggleRight, { size: 20 }) : React.createElement(ToggleLeft, { size: 20 }),
                                                        adminStudentData.aktivni === 'ano' ? "Aktivní" : "Neaktivní"
                                                    )
                                                ),
                                                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                                    React.createElement('div', null,
                                                        React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-500 block mb-1" }, "Datum nástupu"),
                                                        React.createElement('input', { type: "date", value: adminStudentData.datumNastupu, onChange: e => setAdminStudentData({...adminStudentData, datumNastupu: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl text-sm" })
                                                    ),
                                                    React.createElement('div', null,
                                                        React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-500 block mb-1" }, "Datum ukončení"),
                                                        React.createElement('input', { type: "date", value: adminStudentData.datumUkonceni, onChange: e => setAdminStudentData({...adminStudentData, datumUkonceni: e.target.value}), className: "w-full p-2 bg-slate-50 border rounded-xl text-sm" })
                                                    )
                                                ),
                                                React.createElement('button', { onClick: handleUpdateStudentDetails, disabled: loading, className: "w-full py-2 bg-blue-50 text-blue-600 font-bold uppercase text-[10px] rounded-xl hover:bg-blue-100 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" }, 
                                                    loading ? React.createElement(React.Fragment, null, React.createElement(Loader2, { className: "animate-spin w-4 h-4" }), "Ukládám...") : "Uložit všechny údaje"
                                                )
                                            )
                                        ),
                                        React.createElement('div', { className: "bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm" },
                                            React.createElement('h3', { className: "font-bold text-emerald-600 uppercase text-xs mb-4" }, "Dokončené úkoly (Historie)"),
                                            React.createElement('div', { className: "max-h-80 overflow-y-auto custom-scroll space-y-6 pr-2" },
                                                (() => {
                                                    const studentProgress = data.progress
                                                        .filter(p => p.userLogin === selectedStudent.login)
                                                        .map(p => ({...p, material: data.materials.find(m => String(m.id) === String(p.materialId))}))
                                                        .filter(p => p.material);
                                                    
                                                    // Group by school year
                                                    const grouped = {};
                                                    studentProgress.forEach(p => {
                                                        const label = getSchoolYearLabel(p.datum);
                                                        if (!grouped[label]) grouped[label] = [];
                                                        grouped[label].push(p);
                                                    });

                                                    if (Object.keys(grouped).length === 0) return React.createElement('div', { className: "text-slate-400 text-sm italic" }, "Zatím žádné splněné úkoly.");

                                                    // Sort keys descending (newest year first)
                                                    return Object.keys(grouped).sort().reverse().map(year => 
                                                        React.createElement('div', { key: year },
                                                            React.createElement('h4', { className: "text-[10px] font-bold uppercase text-slate-400 mb-2 border-b border-slate-100 pb-1" }, `Školní rok ${year}`),
                                                            React.createElement('div', { className: "space-y-2" },
                                                                grouped[year].sort((a,b) => new Date(b.datum) - new Date(a.datum)).map((p, i) => 
                                                                    React.createElement('div', { key: i, className: "flex flex-col p-3 bg-slate-50 rounded-2xl gap-1 border border-slate-100 hover:border-blue-200 transition-colors" },
                                                                        React.createElement('div', { className: "flex justify-between items-start" },
                                                                            React.createElement('div', null,
                                                                               React.createElement('span', { className: `text-[9px] font-bold uppercase px-2 py-0.5 rounded-md mb-1 inline-block border bg-white opacity-70` }, p.material.predmet),
                                                                               React.createElement('div', { className: "text-sm font-bold text-slate-700 leading-tight" }, p.material.nazev)
                                                                            ),
                                                                            React.createElement('div', { className: "text-[10px] text-slate-400 whitespace-nowrap" }, new Date(p.datum).toLocaleDateString())
                                                                        )
                                                                    )
                                                                )
                                                            )
                                                        )
                                                    );
                                                })()
                                            )
                                        )
                                    ),
                                    React.createElement('div', { className: "space-y-6" },
                                        React.createElement('div', { className: "bg-indigo-50 p-8 rounded-[2rem] border border-indigo-100 shadow-sm" },
                                            React.createElement('h3', { className: "font-bold text-indigo-900 uppercase text-xs mb-6" }, "Nahrát osobní hodnocení"),
                                            isUploading ? React.createElement('div', { className: "text-center py-10 text-indigo-600 font-bold" }, React.createElement(Loader2, { className: "animate-spin w-8 h-8 mx-auto mb-2" }), "Nahrávám...") :
                                            React.createElement('form', { onSubmit: handlePersonalUpload, className: "space-y-4" },
                                                React.createElement('div', null,
                                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-indigo-400 ml-2 block mb-1" }, "Soubor"),
                                                    React.createElement('input', { type: "file", required: true, onChange: e => setPersonalUploadFile(e.target.files ? e.target.files[0] : null), className: "w-full p-3 bg-white border border-indigo-100 rounded-2xl text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-indigo-100 file:text-indigo-700 hover:file:bg-indigo-200" })
                                                ),
                                                React.createElement('div', null,
                                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-indigo-400 ml-2 block mb-1" }, "Název dokumentu (např. Vysvědčení)"),
                                                    React.createElement('input', { required: true, value: personalUploadName, onChange: e => setPersonalUploadName(e.target.value), className: "w-full p-4 bg-white border border-indigo-100 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500" })
                                                ),
                                                React.createElement('button', { type: "submit", className: "w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold uppercase shadow-lg hover:bg-indigo-700 transition-all flex justify-center gap-2" }, React.createElement(UploadCloud, { size: 20 }), "Nahrát dokument")
                                            )
                                        ),
                                        React.createElement('div', { className: "bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm" },
                                            React.createElement('h3', { className: "font-bold text-slate-900 uppercase text-xs mb-4" }, "Nahrané dokumenty"),
                                            React.createElement('div', { className: "space-y-2 max-h-60 overflow-y-auto custom-scroll pr-2" },
                                                (data.personalDocs || []).filter(d => d.userLogin === selectedStudent.login).map(d => 
                                                    React.createElement('div', { key: d.id, className: "flex items-center justify-between p-4 bg-slate-50 rounded-2xl hover:bg-slate-100 transition-colors group" },
                                                        React.createElement('a', { href: d.url, target: "_blank", className: "flex items-center gap-3 flex-1" },
                                                            React.createElement('div', { className: "bg-white p-2 rounded-xl border border-slate-200 text-indigo-500" }, React.createElement(FileText, { size: 18 })),
                                                            React.createElement('div', null,
                                                                React.createElement('div', { className: "font-bold text-slate-800 text-sm" }, d.nazev),
                                                                React.createElement('div', { className: "text-[10px] text-slate-400" }, new Date(d.datum).toLocaleDateString())
                                                            )
                                                        ),
                                                        React.createElement('div', { className: "flex items-center gap-2" },
                                                            React.createElement('a', { href: d.url, target: "_blank", className: "p-2 text-slate-300 hover:text-indigo-500 transition-colors" }, React.createElement(FileOutput, { size: 16 })),
                                                            React.createElement('button', { onClick: (e) => handleDeletePersonalDoc(e, d.id), className: "p-2 text-red-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all" }, React.createElement(Trash2, { size: 16 }))
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        ),
                        // CONFIG VIEW
                        viewMode === 'config' && React.createElement('div', { className: "animate-in h-full flex flex-col" },
                             React.createElement('div', { className: "flex items-center justify-between mb-8" },
                                React.createElement('h2', { className: "text-3xl font-bold text-blue-900 uppercase" }, "Nastavení portálu"),
                                React.createElement('button', { onClick: () => { setViewMode('portal'); setConfigEditItem(null); }, className: "p-3 bg-slate-200 rounded-xl hover:bg-slate-300" }, React.createElement(X, { className: "w-5 h-5" }))
                            ),
                            React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1" },
                                React.createElement('div', { className: "lg:col-span-4" },
                                    React.createElement('div', { className: "bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-md sticky top-28" },
                                        React.createElement('h3', { className: "font-bold uppercase text-xs mb-6 text-blue-500" }, configEditItem ? 'Upravit položku' : 'Nová položka'),
                                        React.createElement('form', { onSubmit: handleConfigSave, className: "space-y-4" },
                                            React.createElement('div', null,
                                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2" }, "Kategorie"),
                                                React.createElement('select', { value: configEditItem ? configEditItem.kategorie : newConfig.kategorie, onChange: e => configEditItem ? setConfigEditItem({...configEditItem, kategorie: e.target.value}) : setNewConfig({...newConfig, kategorie: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                                    React.createElement('option', { value: "Predmet" }, "Předmět"), 
                                                    React.createElement('option', { value: "Trida" }, "Třída"), 
                                                    React.createElement('option', { value: "Typ" }, "Typ dokumentu"),
                                                    React.createElement('option', { value: "Tag" }, "Štítek (Tag)")
                                                )
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2" }, "Název"),
                                                React.createElement('input', { value: configEditItem ? configEditItem.nazev : newConfig.nazev, onChange: e => configEditItem ? setConfigEditItem({...configEditItem, nazev: e.target.value}) : setNewConfig({...newConfig, nazev: e.target.value}), placeholder: "Např. Prvouka", required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600 transition-all" })
                                            ),
                                            ((configEditItem?.kategorie || newConfig.kategorie) === 'Predmet') && React.createElement('div', null,
                                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2" }, "Barva"),
                                                React.createElement('select', { value: configEditItem ? configEditItem.hodnota : newConfig.hodnota, onChange: e => configEditItem ? setConfigEditItem({...configEditItem, hodnota: e.target.value}) : setNewConfig({...newConfig, hodnota: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                                    ["modra","zelena","cervena","zluta","fialova","oranzova","seda","ruzova","tyrkys","limeta","hneda","cerna"].map(c => React.createElement('option', { key: c, value: c }, c))
                                                )
                                            ),
                                            React.createElement('button', { className: "w-full bg-blue-600 text-white py-4 rounded-2xl font-bold uppercase shadow-xl hover:bg-blue-700 transition-all" }, configEditItem ? 'Uložit změny' : 'Přidat položku'),
                                            configEditItem && React.createElement('button', { type: "button", onClick: () => setConfigEditItem(null), className: "w-full text-slate-400 text-[10px] uppercase font-bold py-2" }, "Zrušit editaci")
                                        )
                                    )
                                ),
                                React.createElement('div', { className: "lg:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-4" },
                                    React.createElement('div', { className: "bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col h-[500px]" },
                                        React.createElement('h4', { className: "font-bold text-blue-900 uppercase text-[11px] mb-4 border-b pb-2" }, "Předměty"),
                                        React.createElement('div', { className: "flex-1 overflow-y-auto custom-scroll space-y-2 pr-2" },
                                            data.config.filter(c => c.kategorie === 'Predmet').map(c => React.createElement('div', { key: c.nazev, className: "flex items-center justify-between p-3 bg-slate-50 rounded-2xl border border-slate-100" },
                                                React.createElement('div', { className: "flex items-center gap-3" }, React.createElement('span', { className: `w-3 h-3 rounded-full btn-${c.hodnota}` }), React.createElement('b', { className: "text-sm text-slate-700" }, c.nazev)),
                                                React.createElement('div', { className: "flex gap-2" },
                                                    React.createElement('button', { onClick: () => setConfigEditItem(c), className: "p-2 text-blue-400 hover:bg-white rounded-lg transition-all" }, React.createElement(Edit3, { size: 14 })),
                                                    React.createElement('button', { onClick: () => handleConfigDelete(c), className: "p-2 text-red-300 hover:text-red-500" }, React.createElement(Trash2, { size: 14 }))
                                                )
                                            ))
                                        )
                                    ),
                                    React.createElement('div', { className: "bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col h-[500px]" },
                                        React.createElement('h4', { className: "font-bold text-blue-900 uppercase text-[11px] mb-4 border-b pb-2" }, "Třídy, Typy a Tagy"),
                                        React.createElement('div', { className: "flex-1 overflow-y-auto custom-scroll space-y-2 pr-2" },
                                            data.config.filter(c => c.kategorie !== 'Predmet').map(c => React.createElement('div', { key: c.nazev, className: "flex items-center justify-between p-3 bg-slate-50 rounded-2xl border border-slate-100" },
                                                React.createElement('div', null, React.createElement('b', { className: "text-sm text-slate-700" }, c.nazev), React.createElement('br'), React.createElement('small', { className: "text-[9px] uppercase text-slate-400 font-bold" }, c.kategorie)),
                                                React.createElement('div', { className: "flex gap-2" },
                                                    React.createElement('button', { onClick: () => setConfigEditItem(c), className: "p-2 text-blue-400 hover:bg-white rounded-lg transition-all" }, React.createElement(Edit3, { size: 14 })),
                                                    React.createElement('button', { onClick: () => handleConfigDelete(c), className: "p-2 text-red-300 hover:text-red-500" }, React.createElement(Trash2, { size: 14 }))
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        ),
                        // DATALIST FOR TAGS
                        React.createElement('datalist', { id: "tag-suggestions" },
                            uniqueTags.filter(t => t !== "Vše").map(t => React.createElement('option', { key: t, value: t }))
                        )
                    )
                ),

                // TOAST
                toast && React.createElement('div', { className: "fixed bottom-8 left-1/2 -translate-x-1/2 z-[100] animate-in" },
                    React.createElement('div', { className: `${toast.type === 'error' ? 'bg-red-600' : 'bg-blue-600'} text-white px-8 py-4 rounded-full shadow-2xl font-bold uppercase text-[10px] tracking-widest flex items-center gap-3` },
                        React.createElement(toast.type === 'error' ? X : CheckCircle, { className: "w-4 h-4 text-white/80" }), toast.msg
                    )
                ),

                // CONFIRM MODAL
                React.createElement(ConfirmModal, { ...confirmModal, onCancel: () => setConfirmModal({...confirmModal, show: false}) }),

                // UPLOAD MODAL
                showUploadModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay", onClick: () => setShowUploadModal(false) },
                    React.createElement('div', { className: "bg-white rounded-[3.5rem] shadow-2xl w-full max-w-xl p-12 animate-in relative overflow-hidden flex flex-col max-h-[85vh]", onClick: e => e.stopPropagation() },
                        isUploading && React.createElement('div', { className: "absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center text-blue-600 font-bold uppercase text-xs" },
                             React.createElement(Loader2, { className: "animate-spin w-8 h-8 mb-2" }), " Ukládám podklady..."
                        ),
                        React.createElement('div', { className: "flex justify-between items-center mb-6 shrink-0" },
                            React.createElement('h2', { className: "text-2xl font-bold text-blue-900 uppercase" }, "Nový materiál"),
                            React.createElement('button', { onClick: () => setShowUploadModal(false), className: "text-slate-300 hover:text-slate-500 transition-all" }, React.createElement(X, { className: "w-8 h-8" }))
                        ),
                        React.createElement('form', { onSubmit: handleUploadSubmit, className: "space-y-4 text-sm overflow-y-auto custom-scroll pr-2" },
                            React.createElement('div', { className: "p-4 bg-slate-50 rounded-2xl border border-slate-100 mb-4" },
                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-2" }, "Soubor nebo Odkaz (Zadejte alespoň jedno)"),
                                React.createElement('div', { className: "flex gap-4" },
                                    React.createElement('div', { className: "relative flex-1" },
                                        React.createElement('input', { type: "file", onChange: e => setUploadFile(e.target.files ? e.target.files[0] : null), className: "hidden", id: "file-upload" }),
                                        React.createElement('label', { htmlFor: "file-upload", className: "w-full p-3 bg-white border border-dashed border-blue-200 rounded-xl flex items-center justify-center gap-2 text-slate-500 cursor-pointer hover:bg-blue-50 transition-colors h-full" },
                                            React.createElement(UploadCloud, { className: "w-4 h-4 text-blue-400" }),
                                            uploadFile ? React.createElement('span', { className: "text-blue-600 font-bold truncate max-w-[100px]" }, uploadFile.name) : "Nahrát soubor"
                                        )
                                    ),
                                    React.createElement('div', { className: "flex-1" },
                                        React.createElement('input', { value: uploadMeta.odkazWeb, onChange: e => setUploadMeta({...uploadMeta, odkazWeb: e.target.value}), placeholder: "https://www...", className: "w-full p-3 bg-white border rounded-xl outline-none focus:ring-2 focus:ring-blue-600 transition-all h-full" })
                                    )
                                )
                            ),
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Název"), React.createElement('input', { value: uploadMeta.nazev, onChange: e => setUploadMeta({...uploadMeta, nazev: e.target.value}), placeholder: "Co děti uvidí na kartě", required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Popisek / Poznámka"), React.createElement('textarea', { value: uploadMeta.poznamka, onChange: e => setUploadMeta({...uploadMeta, poznamka: e.target.value}), placeholder: "Krátký popis obsahu...", className: "w-full p-4 bg-slate-50 border rounded-2xl h-24 outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                            
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Třída"),
                                    React.createElement('select', { value: uploadMeta.trida, onChange: e => setUploadMeta({...uploadMeta, trida: e.target.value}), required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "", disabled: true }, "Vybrat"),
                                        React.createElement('option', { value: GENERAL_INFO_LABEL, className: "text-blue-600 font-bold" }, `📌 ${GENERAL_INFO_LABEL}`),
                                        data.config.filter(c => c.kategorie === 'Trida').map(c => c.nazev).sort().map(g => React.createElement('option', { key: g }, g))
                                    )
                                ),
                                uploadMeta.trida !== GENERAL_INFO_LABEL && React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Předmět"),
                                    React.createElement('select', { value: uploadMeta.predmet, onChange: e => setUploadMeta({...uploadMeta, predmet: e.target.value}), required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "", disabled: true }, "Vybrat"),
                                        uniqueSubjects.filter(s => s !== 'Vše').map(s => React.createElement('option', { key: s }, s))
                                    )
                                )
                            ),
                             React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                uploadMeta.trida !== GENERAL_INFO_LABEL && React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Typ"),
                                    React.createElement('select', { value: uploadMeta.typ, onChange: e => setUploadMeta({...uploadMeta, typ: e.target.value}), required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "", disabled: true }, "Vybrat"),
                                        data.config.filter(c => c.kategorie === 'Typ').map(t => React.createElement('option', { key: t.nazev }, t.nazev))
                                    )
                                ),
                                React.createElement('div', null,
                                     React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Období"),
                                     React.createElement('select', { value: uploadMeta.obdobi, onChange: e => setUploadMeta({...uploadMeta, obdobi: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "0" }, "Celoroční / Neurčeno"),
                                        React.createElement('option', { value: "1" }, "1. Pololetí (Září - Leden)"),
                                        React.createElement('option', { value: "2" }, "2. Pololetí (Únor - Červen)")
                                    )
                                )
                            ),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                     React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Cílová skupina"),
                                     React.createElement('select', { value: uploadMeta.cilovaSkupina, onChange: e => setUploadMeta({...uploadMeta, cilovaSkupina: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "all" }, "Všichni"),
                                        React.createElement('option', { value: "interni" }, "Pouze Interní"),
                                        React.createElement('option', { value: "externi" }, "Pouze Externí")
                                    )
                                ),
                                React.createElement('div', null, 
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Tagy (#...)"), 
                                    React.createElement('input', { value: uploadMeta.tagy, onChange: e => setUploadMeta({...uploadMeta, tagy: e.target.value}), list: "tag-suggestions", placeholder: "např. gramatika", className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" })
                                )
                            ),
                            
                            React.createElement('button', { className: "w-full bg-emerald-600 text-white py-5 rounded-[2rem] font-bold uppercase shadow-xl hover:bg-emerald-700 transition-all mt-4 active:scale-95" }, "Publikovat do studovny")
                        )
                    )
                ),

                // EDIT MODAL
                showEditModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay", onClick: () => setShowEditModal(null) },
                    React.createElement('div', { className: "bg-white rounded-[3.5rem] shadow-2xl w-full max-w-xl p-12 animate-in relative flex flex-col max-h-[85vh]", onClick: e => e.stopPropagation() },
                        isUploading && React.createElement('div', { className: "absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center text-blue-600 font-bold uppercase text-xs" },
                             React.createElement(Loader2, { className: "animate-spin w-8 h-8 mb-2" }), " Aktualizuji..."
                        ),
                        React.createElement('div', { className: "flex justify-between items-center mb-6 shrink-0" }, React.createElement('h2', { className: "text-2xl font-bold text-blue-900 uppercase" }, "Upravit informace"), React.createElement('button', { onClick: () => setShowEditModal(null), className: "text-slate-300 hover:text-red-500 transition-all" }, React.createElement(X, { className: "w-8 h-8" }))),
                        React.createElement('form', { onSubmit: handleEditSubmit, className: "space-y-4 text-sm overflow-y-auto custom-scroll pr-2" },
                            React.createElement('div', { className: "p-4 bg-slate-50 rounded-2xl border border-slate-100 mb-4" },
                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-2" }, "Webový Odkaz (Doplněk)"),
                                React.createElement('input', { value: showEditModal.odkazWeb || '', onChange: e => setShowEditModal({...showEditModal, odkazWeb: e.target.value}), placeholder: "https://www...", className: "w-full p-3 bg-white border rounded-xl outline-none focus:ring-2 focus:ring-blue-600 transition-all" })
                            ),
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Název materiálu"), React.createElement('input', { value: showEditModal.nazev, onChange: e => setShowEditModal({...showEditModal, nazev: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Popisek / Poznámka"), React.createElement('textarea', { value: showEditModal.poznamka, onChange: e => setShowEditModal({...showEditModal, poznamka: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl h-24 outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                             React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Třída"),
                                    React.createElement('select', { value: showEditModal.trida, onChange: e => setShowEditModal({...showEditModal, trida: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                        React.createElement('option', { value: GENERAL_INFO_LABEL }, GENERAL_INFO_LABEL),
                                        data.config.filter(c => c.kategorie === 'Trida').map(c => c.nazev).sort().map(g => React.createElement('option', { key: g }, g))
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Předmět"),
                                    React.createElement('select', { value: showEditModal.predmet, onChange: e => setShowEditModal({...showEditModal, predmet: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                         uniqueSubjects.filter(s => s !== 'Vše').map(s => React.createElement('option', { key: s }, s))
                                    )
                                )
                            ),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Typ materiálu"),
                                    React.createElement('select', { value: showEditModal.typ, onChange: e => setShowEditModal({...showEditModal, typ: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                        data.config.filter(c => c.kategorie === 'Typ').map(t => React.createElement('option', { key: t.nazev }, t.nazev))
                                    )
                                ),
                                React.createElement('div', null,
                                     React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Období"),
                                     React.createElement('select', { value: showEditModal.obdobi || '0', onChange: e => setShowEditModal({...showEditModal, obdobi: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "0" }, "Celoroční / Neurčeno"),
                                        React.createElement('option', { value: "1" }, "1. Pololetí (Září - Leden)"),
                                        React.createElement('option', { value: "2" }, "2. Pololetí (Únor - Červen)")
                                    )
                                )
                            ),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                     React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Cílová skupina"),
                                     React.createElement('select', { value: showEditModal.cilovaSkupina || 'all', onChange: e => setShowEditModal({...showEditModal, cilovaSkupina: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "all" }, "Všichni"),
                                        React.createElement('option', { value: "interni" }, "Pouze Interní"),
                                        React.createElement('option', { value: "externi" }, "Pouze Externí")
                                    )
                                ),
                                React.createElement('div', null, 
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Tagy (#...)"), 
                                    React.createElement('input', { value: showEditModal.tagy, onChange: e => setShowEditModal({...showEditModal, tagy: e.target.value}), list: "tag-suggestions", className: "w-full p-4 bg-slate-50 border rounded-2xl text-sm outline-none" })
                                )
                            ),
                            
                            React.createElement('div', { className: "pt-4 border-t border-slate-100" },
                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-red-400 ml-2 block mb-1" }, "Nahradit soubor (Volitelné)"),
                                React.createElement('div', { className: "relative" },
                                    React.createElement('input', { type: "file", onChange: e => setEditFile(e.target.files ? e.target.files[0] : null), className: "hidden", id: "file-edit-upload" }),
                                    React.createElement('label', { htmlFor: "file-edit-upload", className: "w-full p-3 bg-red-50 border border-dashed border-red-200 rounded-2xl flex items-center justify-center gap-3 text-slate-500 cursor-pointer hover:bg-red-100 transition-colors" },
                                        React.createElement(UploadCloud, { className: "w-4 h-4 text-red-400" }),
                                        editFile ? React.createElement('span', { className: "text-red-600 font-bold" }, editFile.name) : "Nahrát novou verzi..."
                                    )
                                ),
                                React.createElement('p', { className: "text-[9px] text-slate-400 mt-1 ml-2" }, "Původní soubor zůstane na disku, ale odkaz v kartě se aktualizuje. Vazba na žáky (splněno) zůstane zachována.")
                            ),

                            React.createElement('button', { className: "w-full bg-blue-600 text-white py-5 rounded-[2rem] font-bold uppercase shadow-xl hover:bg-blue-700 transition-all mt-4" }, "Uložit změny")
                        )
                    )
                ),

                // PROFILE MODAL
                showProfileModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay", onClick: () => setShowProfileModal(false) },
                    React.createElement('div', { className: "bg-white rounded-[3.5rem] shadow-2xl w-full max-w-md p-10 animate-in relative flex flex-col max-h-[85vh]", onClick: e => e.stopPropagation() },
                        React.createElement('div', { className: "flex justify-between items-center mb-8 shrink-0" },
                            React.createElement('h2', { className: "text-2xl font-bold text-blue-900 uppercase" }, "Můj profil"),
                            React.createElement('button', { onClick: () => setShowProfileModal(false), className: "text-slate-300 hover:text-slate-500 transition-all" }, React.createElement(X, { className: "w-8 h-8" }))
                        ),
                        React.createElement('div', { className: "overflow-y-auto custom-scroll pr-2 flex-1" },
                            React.createElement('div', { className: "text-center mb-6" },
                                React.createElement('div', { className: "w-20 h-20 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold mx-auto mb-4" }, React.createElement(UserCircle, { size: 40 })),
                                React.createElement('h3', { className: "text-xl font-bold text-slate-800" }, user.jmeno),
                                React.createElement('div', { className: "flex items-center justify-center gap-2 mt-1" },
                                    React.createElement('span', { className: "text-slate-400 text-sm font-mono" }, user.login),
                                    React.createElement('span', { className: `px-2 py-0.5 rounded text-[10px] uppercase font-bold ${user.typStudenta === 'externi' ? 'bg-amber-100 text-amber-600' : 'bg-purple-100 text-purple-600'}` }, user.typStudenta)
                                )
                            ),
                            React.createElement('form', { onSubmit: handleProfileSave, className: "space-y-4 mb-8" },
                                user.role !== 'admin' && React.createElement(React.Fragment, null,
                                    user.typStudenta === 'externi' 
                                    ? React.createElement('div', { className: "bg-amber-50 p-4 rounded-2xl border border-amber-100 text-amber-700 text-xs text-center font-bold" }, "Jako externí student máte přiřazenou pevnou třídu: ", user.mojeTrida || "Nenastaveno")
                                    : React.createElement('div', null,
                                        React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Moje třída (výchozí filtr)"),
                                        React.createElement('select', { value: profileConfig.mojeTrida, onChange: e => setProfileConfig({...profileConfig, mojeTrida: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                            React.createElement('option', { value: "" }, "Vybrat třídu..."),
                                            uniqueGrades.map(g => React.createElement('option', { key: g, value: g }, g))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "E-mail rodiče"),
                                        React.createElement('input', { type: "email", value: profileConfig.emailRodice, onChange: e => setProfileConfig({...profileConfig, emailRodice: e.target.value}), placeholder: "vas@email.cz", className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" })
                                    ),
                                    React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Věk (číslo)"),
                                            React.createElement('input', { type: "number", value: profileConfig.vek, onChange: e => setProfileConfig({...profileConfig, vek: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" })
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Kmenová škola"),
                                            React.createElement('input', { type: "text", value: profileConfig.kmenovaSkola, onChange: e => setProfileConfig({...profileConfig, kmenovaSkola: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" })
                                        )
                                    ),
                                    React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                        React.createElement('div', null,
                                            React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-300 ml-2 block mb-1" }, "Datum nástupu"),
                                            React.createElement('div', { className: "w-full p-4 bg-slate-50 border rounded-2xl text-sm text-slate-500 font-mono" }, formatDateCZ(user.datumNastupu))
                                        ),
                                        React.createElement('div', null,
                                            React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-300 ml-2 block mb-1" }, "Datum ukončení"),
                                            React.createElement('div', { className: "w-full p-4 bg-slate-50 border rounded-2xl text-sm text-slate-500 font-mono" }, formatDateCZ(user.datumUkonceni))
                                        )
                                    )
                                ),
                                React.createElement('button', { type: "submit", className: "w-full bg-blue-600 text-white py-4 rounded-2xl font-bold uppercase shadow-xl hover:bg-blue-700 transition-all mt-4" }, "Uložit nastavení")
                            ),
                            user.role !== 'admin' && React.createElement('div', { className: "border-t border-slate-100 pt-6" },
                                React.createElement('h3', { className: "font-bold text-blue-900 uppercase text-xs mb-4" }, "Moje hodnocení a dokumenty"),
                                React.createElement('div', { className: "space-y-2 max-h-48 overflow-y-auto custom-scroll pr-2" },
                                    (data.personalDocs || []).filter(d => d.userLogin === user.login).length > 0 ?
                                    (data.personalDocs || []).filter(d => d.userLogin === user.login).map(d => 
                                        React.createElement('a', { key: d.id, href: d.url, target: "_blank", className: "flex items-center justify-between p-4 bg-indigo-50 rounded-2xl border border-indigo-100 hover:bg-indigo-100 transition-colors group" },
                                            React.createElement('div', { className: "flex items-center gap-3" },
                                                React.createElement('div', { className: "bg-white p-2 rounded-xl text-indigo-500" }, React.createElement(FileText, { size: 16 })),
                                                React.createElement('div', null,
                                                    React.createElement('div', { className: "font-bold text-indigo-900 text-sm" }, d.nazev),
                                                    React.createElement('div', { className: "text-[10px] text-indigo-400" }, new Date(d.datum).toLocaleDateString())
                                                )
                                            ),
                                            React.createElement(FileOutput, { size: 16, className: "text-indigo-300 group-hover:text-indigo-600" })
                                        )
                                    ) : React.createElement('div', { className: "text-slate-400 text-center text-sm py-4 italic" }, "Zatím žádná hodnocení.")
                                )
                            )
                        )
                    )
                ),

                // NEWS MODAL
                showNewsModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay", onClick: () => setShowNewsModal(false) },
                     React.createElement('div', { className: "bg-white rounded-[3.5rem] shadow-2xl w-full max-w-lg p-10 animate-in relative flex flex-col max-h-[85vh]", onClick: e => e.stopPropagation() },
                        React.createElement('div', { className: "flex justify-between items-center mb-8 shrink-0" },
                            React.createElement('h2', { className: "text-2xl font-bold text-blue-900 uppercase flex items-center gap-3" }, React.createElement(Bell, { className: "text-amber-500" }), "Aktuality"),
                            React.createElement('button', { onClick: () => setShowNewsModal(false), className: "text-slate-300 hover:text-slate-500 transition-all" }, React.createElement(X, { className: "w-8 h-8" }))
                        ),
                        React.createElement('div', { className: "overflow-y-auto custom-scroll pr-2 flex-1 space-y-4" },
                            data.news.length > 0 ? data.news.sort((a,b) => new Date(b.datum) - new Date(a.datum)).map(n => 
                                React.createElement('div', { key: n.id, className: `p-6 rounded-[2rem] border ${n.priorita === 'vysoka' ? 'bg-red-50 border-red-100' : 'bg-slate-50 border-slate-100'}` },
                                    React.createElement('div', { className: "flex justify-between items-start mb-2" },
                                        React.createElement('h3', { className: `font-bold text-lg ${n.priorita === 'vysoka' ? 'text-red-800' : 'text-slate-800'}` }, n.titulek),
                                        React.createElement('span', { className: "text-[10px] text-slate-400 uppercase font-bold" }, new Date(n.datum).toLocaleDateString())
                                    ),
                                    React.createElement('p', { className: "text-sm text-slate-600 leading-relaxed whitespace-pre-wrap" }, n.text)
                                )
                            ) : React.createElement('div', { className: "text-center text-slate-400 py-10" }, "Žádné nové zprávy.")
                        )
                    )
                )
            );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(React.createElement(App));
    </script>
</body>
</html>

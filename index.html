<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domoškola Líšeň - CMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif; }
        
        /* BARVY KARET */
        .card-modra { background-color: #eff6ff; border-color: #bfdbfe; }
        .card-zelena { background-color: #ecfdf5; border-color: #a7f3d0; }
        .card-cervena { background-color: #fef2f2; border-color: #fecaca; }
        .card-zluta { background-color: #fefce8; border-color: #fef08a; }
        .card-fialova { background-color: #faf5ff; border-color: #e9d5ff; }
        .card-oranzova { background-color: #fff7ed; border-color: #fed7aa; }
        .card-seda { background-color: #f8fafc; border-color: #e2e8f0; }

        /* BARVY TLAČÍTEK */
        .btn-modra { background-color: #2563eb !important; }
        .btn-zelena { background-color: #059669 !important; }
        .btn-cervena { background-color: #dc2626 !important; }
        .btn-zluta { background-color: #ca8a04 !important; }
        .btn-fialova { background-color: #7c3aed !important; }
        .btn-oranzova { background-color: #ea580c !important; }
        .btn-seda { background-color: #475569 !important; }
        
        /* ANIMACE */
        .animate-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-overlay { background-color: rgba(0, 0, 0, 0.4); backdrop-filter: blur(8px); }
        
        .custom-checkbox { width: 22px; height: 22px; border-radius: 6px; border: 2px solid #cbd5e1; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .custom-checkbox.checked { background-color: #2563eb; border-color: #2563eb; color: white; }

        .pulse-yellow { animation: pulseY 1.5s infinite; background-color: #fef9c3; color: #854d0e; }
        @keyframes pulseY { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
    </style>
    <!-- Import React a Lucide přímo z CDN pro funkčnost na GitHub Pages -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.300.0"
      }
    }
    </script>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Search, PlusCircle, FileText, Video, Trash2, Edit3, X, 
            LogOut, Loader2, Save, Filter, Settings, Key, User,
            School, CheckCircle, Check, Layers, UploadCloud, Bell
        } from 'lucide-react';

        // --- KONFIGURACE ---
        // Zde je vaše existující URL skriptu.
        const DEFAULT_API_URL = "https://script.google.com/macros/s/AKfycbwYrc9z4UmbZ8JKYK8Gtr03ukacuA51weoGhUtAEYjv5y1ilLWpwwIslilhy3NnnWAgCw/exec";

        const App = () => {
            // --- STATE ---
            const [user, setUser] = useState(null);
            const [data, setData] = useState({ materials: [], config: [], users: [], news: [] });
            const [loading, setLoading] = useState(false);
            const [loginError, setLoginError] = useState('');
            
            const [activeGrade, setActiveGrade] = useState("Vše");
            const [activeSubject, setActiveSubject] = useState("Vše");
            const [searchQuery, setSearchQuery] = useState("");
            const [showFilters, setShowFilters] = useState(false);
            const [viewMode, setViewMode] = useState('portal'); // portal, manage, config
            
            const [selectedItems, setSelectedItems] = useState([]);
            const [processingIds, setProcessingIds] = useState([]);
            const [toast, setToast] = useState(null);
            
            const [showUploadModal, setShowUploadModal] = useState(false);
            const [showEditModal, setShowEditModal] = useState(null);
            const [showNewsModal, setShowNewsModal] = useState(false);
            
            const [emailInput, setEmailInput] = useState('');
            const [pinInput, setPinInput] = useState('');

            // Upload State
            const [uploadFile, setUploadFile] = useState(null);
            const [uploadMeta, setUploadMeta] = useState({ nazev: '', poznamka: '', trida: '', predmet: '', typ: '', tagy: '' });
            const [isUploading, setIsUploading] = useState(false);

            // Config State
            const [configEditItem, setConfigEditItem] = useState(null);
            const [newConfig, setNewConfig] = useState({kategorie: 'Predmet', nazev: '', hodnota: 'seda'});

            // --- INIT ---
            useEffect(() => {
                const saved = localStorage.getItem('domoskola_user');
                if (saved) setUser(JSON.parse(saved));
            }, []);

            useEffect(() => {
                if (user) loadData();
            }, [user]);

            const loadData = async () => {
                setLoading(true);
                try {
                    // Voláme akci 'getData', kterou musí Backend podporovat
                    const res = await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'getData' }) });
                    const json = await res.json();
                    
                    if (json.error) throw new Error(json.error);
                    
                    if (json.materials) {
                        json.materials.sort((a, b) => new Date(b.datum).getTime() - new Date(a.datum).getTime());
                    }
                    setData(json);
                } catch (e) {
                    console.error(e);
                } finally {
                    setLoading(false);
                }
            };

            // --- HANDLERS ---
            const handleLogin = (e) => {
                e.preventDefault();
                setLoginError('');
                setLoading(true);
                
                fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'getData' }) })
                    .then(r => r.json())
                    .then(json => {
                        const found = json.users.find(u => 
                            u.email.toLowerCase().trim() === emailInput.toLowerCase().trim() && 
                            String(u.pin).trim() === String(pinInput).trim()
                        );

                        if (found && (found.aktivni === 'ano' || found.aktivni === 'aktivni')) {
                            const userData = { ...found, role: found.role === 'admin' ? 'admin' : 'user' };
                            setUser(userData);
                            localStorage.setItem('domoskola_user', JSON.stringify(userData));
                            setData(json);
                        } else {
                            setLoginError("Neplatné údaje nebo neaktivní účet.");
                        }
                    })
                    .catch((err) => {
                        console.error(err);
                        setLoginError("Chyba připojení k databázi.");
                    })
                    .finally(() => setLoading(false));
            };

            const handleUploadSubmit = async (e) => {
                e.preventDefault();
                if (!uploadFile) return alert("Vyberte soubor");
                
                setIsUploading(true);
                
                // Převod na Base64
                const reader = new FileReader();
                reader.onload = async () => {
                    // Odstranění "data:application/pdf;base64," hlavičky
                    const base64String = reader.result.split(',')[1];
                    
                    const payload = {
                        action: 'upload',
                        filename: uploadFile.name,
                        mimeType: uploadFile.type,
                        base64: base64String,
                        ...uploadMeta
                    };

                    try {
                        await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify(payload) });
                        setToast("Materiál úspěšně nahrán");
                        setShowUploadModal(false);
                        setUploadFile(null);
                        setUploadMeta({ nazev: '', poznamka: '', trida: '', predmet: '', typ: '', tagy: '' });
                        loadData(); // Obnovit data pro zobrazení nového souboru
                    } catch (err) {
                        alert("Chyba nahrávání: " + err);
                    } finally {
                        setIsUploading(false);
                    }
                };
                reader.readAsDataURL(uploadFile);
            };

            const handleAction = async (action, ids, extraData = {}) => {
                setProcessingIds(prev => [...prev, ...ids]);
                
                // Optimistický update UI
                if (action === 'updateStatus') {
                    setData(prev => ({
                        ...prev,
                        materials: prev.materials.map(m => ids.includes(m.id) ? {...m, status: m.status === 'publikovano' ? 'neaktivni' : 'publikovano'} : m)
                    }));
                } else if (action === 'delete') {
                    setData(prev => ({
                        ...prev,
                        materials: prev.materials.filter(m => !ids.includes(m.id))
                    }));
                    setSelectedItems([]);
                } else if (action === 'edit') {
                    setData(prev => ({
                        ...prev,
                        materials: prev.materials.map(m => m.id === extraData.id ? {...m, ...extraData} : m)
                    }));
                    setShowEditModal(null);
                }

                try {
                    await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action, ids, ...extraData }) });
                    setToast("Změny uloženy");
                } catch (e) {
                    alert("Chyba akce");
                } finally {
                    setProcessingIds(prev => prev.filter(pid => !ids.includes(pid)));
                }
            };

            // OPRAVENÁ FUNKCE PRO UKLÁDÁNÍ KONFIGURACE (Žádné mazání, jen update)
            const handleConfigSave = async (e) => {
                e.preventDefault();
                const itemToSave = configEditItem || newConfig;
                
                if (configEditItem) {
                    // EDITACE - Optimistický update (najdi a nahraď)
                    setData(prev => ({
                        ...prev,
                        config: prev.config.map(c => 
                            (c.kategorie === configEditItem.kategorie && c.nazev === configEditItem.nazev) 
                            ? itemToSave 
                            : c
                        )
                    }));
                    
                    // Reset formuláře
                    setConfigEditItem(null);
                    
                    // Voláme backend update
                    await fetch(DEFAULT_API_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ 
                            action: 'updateConfig', 
                            oldItem: configEditItem, 
                            newItem: itemToSave 
                        }) 
                    });
                } else {
                    // NOVÁ POLOŽKA
                    setData(prev => ({
                        ...prev,
                        config: [...prev.config, itemToSave]
                    }));
                    
                    setNewConfig({kategorie: 'Predmet', nazev: '', hodnota: 'seda'});
                    
                    await fetch(DEFAULT_API_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ 
                            action: 'saveConfig', 
                            item: itemToSave 
                        }) 
                    });
                }
                
                // Pro jistotu (volitelné)
                // loadData(); 
            };

            const handleConfigDelete = async (item) => {
                if(!confirm("Opravdu smazat?")) return;
                setData(prev => ({...prev, config: prev.config.filter(c => c !== item)}));
                await fetch(DEFAULT_API_URL, { method: 'POST', body: JSON.stringify({ action: 'deleteConfig', item }) });
            };

            // --- HELPERS ---
            const getCardColor = (predmetName) => {
                const conf = data.config.find(c => c.kategorie === 'Predmet' && c.nazev === predmetName);
                return conf ? conf.hodnota : 'seda';
            };

            // --- RENDER ---
            const uniqueGrades = ["Vše", ...data.config.filter(c => c.kategorie === 'Trida').map(c => c.nazev).sort()];
            const uniqueSubjects = ["Vše", ...data.config.filter(c => c.kategorie === 'Predmet').map(c => c.nazev).sort()];
            
            const filteredMaterials = data.materials.filter(m => {
                if (viewMode === 'portal' && m.status !== 'publikovano') return false;
                const gMatch = activeGrade === "Vše" || m.trida === activeGrade;
                const sMatch = activeSubject === "Vše" || m.predmet === activeSubject;
                const qMatch = (m.nazev + m.tagy + m.predmet + (m.poznamka || "")).toLowerCase().includes(searchQuery.toLowerCase());
                return gMatch && sMatch && qMatch;
            });

            // LOGIN SCREEN
            if (!user) {
                return React.createElement('div', { className: "min-h-screen bg-blue-600 flex items-center justify-center p-6 text-slate-900 font-sans" },
                    React.createElement('div', { className: "max-w-md w-full bg-white rounded-[3.5rem] p-12 shadow-2xl animate-in text-center" },
                        React.createElement('div', { className: "bg-blue-50 w-24 h-24 rounded-[2rem] flex items-center justify-center mx-auto mb-8 text-blue-600 shadow-inner" }, 
                            React.createElement(School, { size: 48, strokeWidth: 2.5 })
                        ),
                        React.createElement('h1', { className: "text-4xl font-black uppercase mb-2 tracking-tight text-blue-900 leading-tight" }, "Domoškola Líšeň"),
                        React.createElement('p', { className: "text-blue-400 font-bold uppercase tracking-widest text-[10px] mb-10" }, "Digitální studovna"),
                        
                        React.createElement('form', { onSubmit: handleLogin, className: "space-y-6" },
                            React.createElement('input', { type: "email", required: true, placeholder: "E-mail", value: emailInput, onChange: e => setEmailInput(e.target.value), className: "w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl text-center outline-none focus:ring-2 focus:ring-blue-600 transition-all placeholder:text-slate-300" }),
                            React.createElement('input', { type: "password", required: true, placeholder: "PIN", value: pinInput, onChange: e => setPinInput(e.target.value), className: "w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl text-center font-mono outline-none focus:ring-2 focus:ring-blue-600 transition-all text-xl placeholder:text-slate-300" }),
                            
                            loginError && React.createElement('p', { className: "text-red-500 text-xs font-bold bg-red-50 p-4 rounded-xl border border-red-100" }, loginError),

                            React.createElement('button', { type: "submit", disabled: loading, className: "w-full bg-blue-600 text-white py-5 rounded-[2rem] font-bold uppercase shadow-xl hover:bg-blue-700 active:scale-95 transition-all flex justify-center items-center gap-2" },
                                loading ? React.createElement(Loader2, { className: "animate-spin" }) : "Vstoupit"
                            )
                        )
                    )
                );
            }

            // APP SCREEN
            return React.createElement('div', { className: "min-h-screen flex flex-col bg-slate-50 text-slate-900 font-sans" },
                // HEADER
                React.createElement('header', { className: "bg-white border-b border-blue-100 sticky top-0 z-40 px-6 py-4 flex items-center justify-between shadow-sm h-20" },
                    React.createElement('button', { onClick: () => window.location.reload(), className: "flex items-center gap-3 group" },
                        React.createElement('div', { className: "bg-blue-600 p-2.5 rounded-2xl text-white shadow-lg group-hover:scale-105 transition-transform" }, React.createElement(School, { className: "w-6 h-6" })),
                        React.createElement('div', { className: "hidden sm:block text-left leading-none" },
                            React.createElement('h1', { className: "font-bold text-xl text-blue-900 uppercase tracking-tight" }, "Domoškola Líšeň"),
                            React.createElement('p', { className: "text-[9px] text-blue-400 font-bold uppercase tracking-widest leading-tight mt-1" }, "Digitální portál")
                        )
                    ),
                    
                    React.createElement('div', { className: "relative flex-1 max-w-sm hidden lg:block mx-8" },
                        React.createElement(Search, { className: "absolute left-4 top-1/2 -translate-y-1/2 text-blue-200 w-4 h-4" }),
                        React.createElement('input', { type: "text", value: searchQuery, onChange: e => setSearchQuery(e.target.value), placeholder: "Hledat látku...", className: "w-full pl-11 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:ring-2 focus:ring-blue-600 text-sm shadow-inner transition-all placeholder:text-slate-300" })
                    ),
                    
                    React.createElement('div', { className: "flex items-center gap-6 shrink-0" },
                        // TLAČÍTKO AKTUALITY
                         React.createElement('button', { onClick: () => setShowNewsModal(true), className: "p-3 bg-amber-100 text-amber-600 hover:bg-amber-200 rounded-2xl transition-all relative", title: "Aktuality" },
                            React.createElement(Bell, { className: "w-5 h-5" }),
                            data.news.length > 0 && React.createElement('span', { className: "absolute -top-1 -right-1 bg-red-500 text-white text-[9px] font-bold w-4 h-4 rounded-full flex items-center justify-center shadow-sm" }, data.news.length)
                        ),
                        React.createElement('div', { className: "text-right hidden sm:block leading-none" },
                            React.createElement('div', { className: "text-[11px] font-bold uppercase text-blue-900" }, user.jmeno),
                            React.createElement('div', { className: "text-[8px] font-bold text-blue-300 uppercase mt-1 tracking-widest" }, user.role)
                        ),
                        React.createElement('button', { onClick: () => { setUser(null); localStorage.removeItem('domoskola_user'); }, className: "p-3 bg-slate-50 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-2xl transition-all", title: "Odhlásit se" },
                            React.createElement(LogOut, { className: "w-5 h-5" })
                        )
                    )
                ),

                React.createElement('div', { className: "max-w-7xl mx-auto p-6 flex flex-col md:flex-row gap-8 flex-1 w-full" },
                    // SIDEBAR
                    React.createElement('aside', { className: "md:w-60 flex-shrink-0" },
                        React.createElement('div', { className: "flex flex-col gap-1 bg-white/50 p-2 rounded-[2rem] border border-blue-50 shadow-sm sticky top-28" },
                            React.createElement('h3', { className: "text-[9px] font-black text-blue-200 uppercase tracking-widest py-4 text-center" }, "Ročníky"),
                            uniqueGrades.map(g => 
                                React.createElement('button', { key: g, onClick: () => { setActiveGrade(g); setViewMode('portal'); }, className: `px-5 py-4 rounded-2xl font-bold text-xs text-left transition-all ${activeGrade === g && viewMode === 'portal' ? 'bg-blue-600 text-white shadow-xl translate-x-2' : 'text-slate-500 hover:bg-white hover:text-blue-600'}` }, g)
                            )
                        )
                    ),

                    // MAIN CONTENT
                    React.createElement('main', { className: "flex-1 min-w-0" },
                        // PORTAL VIEW
                        viewMode === 'portal' && React.createElement('div', { className: "animate-in" },
                            React.createElement('div', { className: "flex items-center justify-between mb-8" },
                                React.createElement('h2', { className: "text-3xl font-bold text-blue-900" }, activeGrade),
                                React.createElement('div', { className: "flex gap-2" },
                                    user.role === 'admin' && React.createElement(React.Fragment, null,
                                        React.createElement('button', { onClick: () => setViewMode('manage'), className: "p-3 bg-white text-blue-600 border border-blue-100 rounded-2xl text-[10px] font-bold uppercase shadow-sm flex items-center gap-2 hover:bg-blue-50 transition-colors" }, React.createElement(Settings, { className: "w-4 h-4" }), " Administrace"),
                                        React.createElement('button', { onClick: () => setShowUploadModal(true), className: "p-3 bg-emerald-600 text-white rounded-2xl text-[10px] font-bold uppercase shadow-lg flex items-center gap-2 hover:bg-emerald-700 transition-colors" }, React.createElement(PlusCircle, { className: "w-4 h-4" }), " Nahrát")
                                    ),
                                    React.createElement('button', { onClick: () => setShowFilters(!showFilters), className: `p-3 rounded-2xl text-[10px] font-bold uppercase transition-all ${showFilters ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-blue-400 border border-blue-100'}` }, "Filtry")
                                )
                            ),

                            React.createElement('div', { className: "flex flex-wrap gap-2 mb-10" },
                                uniqueSubjects.map(s => 
                                    React.createElement('button', { key: s, onClick: () => setActiveSubject(s), className: `px-5 py-3 rounded-2xl text-[10px] font-bold uppercase transition-all ${activeSubject === s ? 'bg-blue-600 text-white shadow-md' : 'bg-white text-blue-400 border border-blue-100 hover:bg-blue-50'}` }, s)
                                )
                            ),

                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-8 pb-20" },
                                filteredMaterials.map(m => {
                                    const color = getCardColor(m.predmet);
                                    return React.createElement('div', { key: m.id, className: `card-${color} border-2 rounded-[2rem] p-8 hover:shadow-xl transition-all group flex flex-col justify-between relative` },
                                        user.role === 'admin' && React.createElement('button', { onClick: () => setShowEditModal(m), className: "absolute top-4 right-4 p-2 bg-white/50 text-blue-600 rounded-xl hover:bg-white shadow-sm opacity-0 group-hover:opacity-100 transition-opacity" }, React.createElement(Edit3, { className: "w-4 h-4" })),
                                        React.createElement('div', null,
                                            React.createElement('span', { className: "px-4 py-1.5 text-[10px] font-bold uppercase rounded-full border border-current opacity-70 mb-6 inline-block font-mono" }, m.predmet),
                                            React.createElement('h3', { className: "text-2xl font-bold text-slate-800 mb-2 leading-tight" }, m.nazev),
                                            React.createElement('p', { className: "text-slate-500 text-sm mb-8 leading-relaxed line-clamp-2" }, m.poznamka)
                                        ),
                                        React.createElement('div', { className: "pt-6 border-t border-white/50 flex flex-col gap-4" },
                                            React.createElement('div', { className: "flex justify-between text-[10px] font-bold text-slate-400 uppercase" },
                                                React.createElement('span', null, new Date(m.datum).toLocaleDateString('cs-CZ')),
                                                React.createElement('span', null, m.typ)
                                            ),
                                            React.createElement('a', { href: m.odkaz, target: "_blank", rel: "noreferrer", className: `w-full flex items-center justify-center gap-3 text-white py-4 rounded-2xl text-[11px] font-bold uppercase shadow-lg active:scale-95 transition-transform btn-${color}` },
                                                m.typ.includes('Video') ? React.createElement(Video, { size: 16 }) : React.createElement(FileText, { size: 16 }),
                                                " Otevřít podklady"
                                            )
                                        )
                                    );
                                }),
                                filteredMaterials.length === 0 && React.createElement('div', { className: "col-span-full text-center py-20 text-slate-400" }, "Nic nenalezeno.")
                            )
                        ),

                        // MANAGE VIEW
                        viewMode === 'manage' && React.createElement('div', { className: "animate-in" },
                            React.createElement('div', { className: "flex items-center justify-between mb-8" },
                                React.createElement('h2', { className: "text-3xl font-bold text-blue-900 uppercase" }, "Administrace"),
                                React.createElement('div', { className: "flex gap-2" },
                                    React.createElement('button', { onClick: () => setViewMode('config'), className: "px-5 py-3 bg-white text-blue-600 border border-blue-100 rounded-2xl text-[10px] font-bold uppercase flex items-center gap-2 shadow-sm hover:bg-blue-50" }, React.createElement(Layers, { className: "w-4 h-4" }), " Nastavení portálu"),
                                    React.createElement('button', { onClick: () => handleAction('updateStatus', selectedItems), disabled: selectedItems.length === 0, className: "px-4 py-3 bg-blue-600 text-white rounded-xl text-[10px] font-bold uppercase shadow-lg disabled:opacity-30 hover:bg-blue-700 transition-colors" }, `Status (${selectedItems.length})`),
                                    React.createElement('button', { onClick: () => { if(confirm('Smazat?')) handleAction('delete', selectedItems); }, disabled: selectedItems.length === 0, className: "px-4 py-3 bg-red-600 text-white rounded-xl text-[10px] font-bold uppercase shadow-lg disabled:opacity-30 hover:bg-red-700 transition-colors" }, "Smazat"),
                                    React.createElement('button', { onClick: () => setViewMode('portal'), className: "p-3 bg-slate-200 rounded-xl hover:bg-slate-300 transition-colors" }, React.createElement(X, { className: "w-5 h-5" }))
                                )
                            ),
                            
                            // TABLE...
                            React.createElement('div', { className: "bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-sm" },
                                React.createElement('table', { className: "w-full text-left text-sm" },
                                    React.createElement('thead', { className: "bg-slate-50 border-b text-[10px] font-bold uppercase text-slate-400" },
                                        React.createElement('tr', null,
                                            React.createElement('th', { className: "p-6" }),
                                            React.createElement('th', { className: "p-6" }, "Materiál"),
                                            React.createElement('th', { className: "p-6" }, "Stav"),
                                            React.createElement('th', { className: "p-6 text-right" }, "Edit")
                                        )
                                    ),
                                    React.createElement('tbody', { className: "divide-y divide-slate-100" },
                                        filteredMaterials.map(m => React.createElement('tr', { key: m.id, className: `hover:bg-slate-50/50 ${selectedItems.includes(m.id) ? 'bg-blue-50/30' : ''}` },
                                            React.createElement('td', { className: "p-6 w-10" },
                                                React.createElement('div', { onClick: () => setSelectedItems(prev => prev.includes(m.id) ? prev.filter(i => i !== m.id) : [...prev, m.id]), className: `custom-checkbox ${selectedItems.includes(m.id) ? 'checked' : ''}` },
                                                    selectedItems.includes(m.id) && React.createElement(Check, { className: "w-3 h-3 text-white" })
                                                )
                                            ),
                                            React.createElement('td', { className: "p-6" },
                                                React.createElement('b', { className: "text-slate-800" }, m.nazev), React.createElement('br'),
                                                React.createElement('small', { className: "text-slate-400 uppercase font-bold text-[10px]" }, `${m.predmet} • ${m.trida}`)
                                            ),
                                            React.createElement('td', { className: "p-6" },
                                                processingIds.includes(m.id) ? React.createElement('span', { className: "pulse-yellow px-3 py-1 rounded-full text-[9px] font-bold uppercase" }, "Ukládám...") :
                                                React.createElement('span', { onClick: () => handleAction('updateStatus', [m.id]), className: `cursor-pointer px-3 py-1 rounded-full text-[9px] font-bold uppercase ${m.status==='publikovano'?'bg-emerald-50 text-emerald-600 border border-emerald-100':'bg-red-50 text-red-400 border border-red-100'}` }, m.status === 'publikovano' ? 'Veřejné' : 'Skryté')
                                            ),
                                            React.createElement('td', { className: "p-6 text-right" },
                                                React.createElement('button', { onClick: () => setShowEditModal(m), className: "p-2 text-blue-400 hover:bg-blue-50 rounded-lg" }, React.createElement(Edit3, { className: "w-5 h-5" }))
                                            )
                                        ))
                                    )
                                )
                            )
                        ),

                        // CONFIG VIEW
                        viewMode === 'config' && React.createElement('div', { className: "animate-in h-full flex flex-col" },
                             React.createElement('div', { className: "flex items-center justify-between mb-8" },
                                React.createElement('h2', { className: "text-3xl font-bold text-blue-900 uppercase" }, "Nastavení portálu"),
                                React.createElement('button', { onClick: () => { setViewMode('manage'); setConfigEditItem(null); }, className: "p-3 bg-slate-200 rounded-xl hover:bg-slate-300" }, React.createElement(X, { className: "w-5 h-5" }))
                            ),
                            React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1" },
                                React.createElement('div', { className: "lg:col-span-4" },
                                    React.createElement('div', { className: "bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-md sticky top-28" },
                                        React.createElement('h3', { className: "font-bold uppercase text-xs mb-6 text-blue-500" }, configEditItem ? 'Upravit položku' : 'Nová položka'),
                                        React.createElement('form', { onSubmit: handleConfigSave, className: "space-y-4" },
                                            React.createElement('div', null,
                                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2" }, "Kategorie"),
                                                React.createElement('select', { value: configEditItem ? configEditItem.kategorie : newConfig.kategorie, onChange: e => configEditItem ? setConfigEditItem({...configEditItem, kategorie: e.target.value}) : setNewConfig({...newConfig, kategorie: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                                    React.createElement('option', { value: "Predmet" }, "Předmět"), React.createElement('option', { value: "Trida" }, "Třída"), React.createElement('option', { value: "Typ" }, "Typ dokumentu")
                                                )
                                            ),
                                            React.createElement('div', null,
                                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2" }, "Název"),
                                                React.createElement('input', { value: configEditItem ? configEditItem.nazev : newConfig.nazev, onChange: e => configEditItem ? setConfigEditItem({...configEditItem, nazev: e.target.value}) : setNewConfig({...newConfig, nazev: e.target.value}), placeholder: "Např. Prvouka", required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" })
                                            ),
                                            ((configEditItem?.kategorie || newConfig.kategorie) === 'Predmet') && React.createElement('div', null,
                                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2" }, "Barva"),
                                                React.createElement('select', { value: configEditItem ? configEditItem.hodnota : newConfig.hodnota, onChange: e => configEditItem ? setConfigEditItem({...configEditItem, hodnota: e.target.value}) : setNewConfig({...newConfig, hodnota: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                                    ["modra","zelena","cervena","zluta","fialova","oranzova","seda"].map(c => React.createElement('option', { key: c, value: c }, c))
                                                )
                                            ),
                                            React.createElement('button', { className: "w-full bg-blue-600 text-white py-4 rounded-2xl font-bold uppercase shadow-xl hover:bg-blue-700 transition-all" }, configEditItem ? 'Uložit změny' : 'Přidat položku'),
                                            configEditItem && React.createElement('button', { type: "button", onClick: () => setConfigEditItem(null), className: "w-full text-slate-400 text-[10px] uppercase font-bold py-2" }, "Zrušit editaci")
                                        )
                                    )
                                ),
                                React.createElement('div', { className: "lg:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-4" },
                                    React.createElement('div', { className: "bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col h-[500px]" },
                                        React.createElement('h4', { className: "font-bold text-blue-900 uppercase text-[11px] mb-4 border-b pb-2" }, "Předměty"),
                                        React.createElement('div', { className: "flex-1 overflow-y-auto custom-scroll space-y-2 pr-2" },
                                            data.config.filter(c => c.kategorie === 'Predmet').map(c => React.createElement('div', { key: c.nazev, className: "flex items-center justify-between p-3 bg-slate-50 rounded-2xl border border-slate-100" },
                                                React.createElement('div', { className: "flex items-center gap-3" }, React.createElement('span', { className: `w-3 h-3 rounded-full btn-${c.hodnota}` }), React.createElement('b', { className: "text-sm text-slate-700" }, c.nazev)),
                                                React.createElement('div', { className: "flex gap-2" },
                                                    React.createElement('button', { onClick: () => setConfigEditItem(c), className: "p-2 text-blue-400 hover:bg-white rounded-lg transition-all" }, React.createElement(Edit3, { size: 14 })),
                                                    React.createElement('button', { onClick: () => handleConfigDelete(c), className: "p-2 text-red-300 hover:text-red-500" }, React.createElement(Trash2, { size: 14 }))
                                                )
                                            ))
                                        )
                                    ),
                                    React.createElement('div', { className: "bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm flex flex-col h-[500px]" },
                                        React.createElement('h4', { className: "font-bold text-blue-900 uppercase text-[11px] mb-4 border-b pb-2" }, "Třídy a Typy"),
                                        React.createElement('div', { className: "flex-1 overflow-y-auto custom-scroll space-y-2 pr-2" },
                                            data.config.filter(c => c.kategorie !== 'Predmet').map(c => React.createElement('div', { key: c.nazev, className: "flex items-center justify-between p-3 bg-slate-50 rounded-2xl border border-slate-100" },
                                                React.createElement('div', null, React.createElement('b', { className: "text-sm text-slate-700" }, c.nazev), React.createElement('br'), React.createElement('small', { className: "text-[9px] uppercase text-slate-400 font-bold" }, c.kategorie)),
                                                React.createElement('div', { className: "flex gap-2" },
                                                    React.createElement('button', { onClick: () => setConfigEditItem(c), className: "p-2 text-blue-400 hover:bg-white rounded-lg transition-all" }, React.createElement(Edit3, { size: 14 })),
                                                    React.createElement('button', { onClick: () => handleConfigDelete(c), className: "p-2 text-red-300 hover:text-red-500" }, React.createElement(Trash2, { size: 14 }))
                                                )
                                            ))
                                        )
                                    )
                                )
                            )
                        )
                    )
                ),

                // TOAST
                toast && React.createElement('div', { className: "fixed bottom-8 left-1/2 -translate-x-1/2 z-[100] animate-in" },
                    React.createElement('div', { className: "bg-blue-600 text-white px-8 py-4 rounded-full shadow-2xl font-bold uppercase text-[10px] tracking-widest flex items-center gap-3" },
                        React.createElement(CheckCircle, { className: "w-4 h-4 text-emerald-400" }), toast
                    )
                ),

                // NEWS MODAL (AKTUALITY)
                showNewsModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay" },
                    React.createElement('div', { className: "bg-white rounded-[3.5rem] shadow-2xl w-full max-w-2xl p-10 animate-in relative flex flex-col max-h-[85vh]" },
                        React.createElement('div', { className: "flex justify-between items-center mb-6" },
                            React.createElement('h2', { className: "text-2xl font-bold text-blue-900 uppercase" }, "Aktuality"),
                            React.createElement('button', { onClick: () => setShowNewsModal(false), className: "text-slate-300 hover:text-slate-500 transition-all" }, React.createElement(X, { className: "w-8 h-8" }))
                        ),
                        React.createElement('div', { className: "flex-1 overflow-y-auto custom-scroll pr-2 space-y-4" },
                            data.news.length === 0 
                            ? React.createElement('div', { className: "text-center text-slate-400 py-10" }, "Žádné aktuality.") 
                            : data.news.map((n, i) => React.createElement('div', { key: i, className: "bg-slate-50 p-6 rounded-3xl border border-slate-100" },
                                React.createElement('div', { className: "flex justify-between items-center mb-2" },
                                    React.createElement('span', { className: "text-[10px] font-bold text-slate-400 uppercase" }, new Date(n.datum).toLocaleDateString('cs-CZ')),
                                    n.priorita && React.createElement('span', { className: "text-[9px] font-bold bg-amber-100 text-amber-600 px-2 py-1 rounded-full uppercase" }, "Důležité")
                                ),
                                React.createElement('h3', { className: "text-lg font-bold text-slate-800 mb-2" }, n.titulek),
                                React.createElement('p', { className: "text-slate-600 text-sm whitespace-pre-line" }, n.text)
                            ))
                        )
                    )
                ),

                // UPLOAD MODAL
                showUploadModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay" },
                    React.createElement('div', { className: "bg-white rounded-[3.5rem] shadow-2xl w-full max-w-xl p-12 animate-in relative overflow-hidden" },
                        isUploading && React.createElement('div', { className: "absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center text-blue-600 font-bold uppercase text-xs" },
                             React.createElement(Loader2, { className: "animate-spin w-8 h-8 mb-2" }), " Ukládám podklady..."
                        ),
                        React.createElement('div', { className: "flex justify-between items-center mb-8" },
                            React.createElement('h2', { className: "text-2xl font-bold text-blue-900 uppercase" }, "Nový materiál"),
                            React.createElement('button', { onClick: () => setShowUploadModal(false), className: "text-slate-300 hover:text-slate-500 transition-all" }, React.createElement(X, { className: "w-8 h-8" }))
                        ),
                        React.createElement('form', { onSubmit: handleUploadSubmit, className: "space-y-4 text-sm" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Soubor z PC"),
                                React.createElement('div', { className: "relative" },
                                    React.createElement('input', { type: "file", onChange: e => setUploadFile(e.target.files ? e.target.files[0] : null), className: "hidden", id: "file-upload" }),
                                    React.createElement('label', { htmlFor: "file-upload", className: "w-full p-4 bg-slate-50 border border-dashed border-blue-200 rounded-2xl flex items-center justify-center gap-3 text-slate-500 cursor-pointer hover:bg-blue-50 transition-colors" },
                                        React.createElement(UploadCloud, { className: "w-5 h-5 text-blue-400" }),
                                        uploadFile ? React.createElement('span', { className: "text-blue-600 font-bold" }, uploadFile.name) : "Vybrat soubor..."
                                    )
                                )
                            ),
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Název"), React.createElement('input', { value: uploadMeta.nazev, onChange: e => setUploadMeta({...uploadMeta, nazev: e.target.value}), placeholder: "Co děti uvidí na kartě", required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Popisek / Poznámka"), React.createElement('textarea', { value: uploadMeta.poznamka, onChange: e => setUploadMeta({...uploadMeta, poznamka: e.target.value}), placeholder: "Krátký popis obsahu...", className: "w-full p-4 bg-slate-50 border rounded-2xl h-24 outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                            
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Třída"),
                                    React.createElement('select', { value: uploadMeta.trida, onChange: e => setUploadMeta({...uploadMeta, trida: e.target.value}), required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "", disabled: true }, "Vybrat"),
                                        uniqueGrades.filter(g => g !== 'Vše').map(g => React.createElement('option', { key: g }, g))
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Předmět"),
                                    React.createElement('select', { value: uploadMeta.predmet, onChange: e => setUploadMeta({...uploadMeta, predmet: e.target.value}), required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "", disabled: true }, "Vybrat"),
                                        uniqueSubjects.filter(s => s !== 'Vše').map(s => React.createElement('option', { key: s }, s))
                                    )
                                )
                            ),
                             React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Typ"),
                                    React.createElement('select', { value: uploadMeta.typ, onChange: e => setUploadMeta({...uploadMeta, typ: e.target.value}), required: true, className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" },
                                        React.createElement('option', { value: "", disabled: true }, "Vybrat"),
                                        data.config.filter(c => c.kategorie === 'Typ').map(t => React.createElement('option', { key: t.nazev }, t.nazev))
                                    )
                                ),
                                React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Tagy (#...)"), React.createElement('input', { value: uploadMeta.tagy, onChange: e => setUploadMeta({...uploadMeta, tagy: e.target.value}), placeholder: "geometrie, gramatika", className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none" }))
                            ),
                            React.createElement('button', { className: "w-full bg-emerald-600 text-white py-5 rounded-[2rem] font-bold uppercase shadow-xl hover:bg-emerald-700 transition-all mt-4 active:scale-95" }, "Publikovat do studovny")
                        )
                    )
                ),

                // EDIT MODAL
                showEditModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-6 modal-overlay" },
                    React.createElement('div', { className: "bg-white rounded-[3.5rem] shadow-2xl w-full max-w-xl p-12 animate-in relative" },
                        React.createElement('div', { className: "flex justify-between items-center mb-8" }, React.createElement('h2', { className: "text-2xl font-bold text-blue-900 uppercase" }, "Upravit informace"), React.createElement('button', { onClick: () => setShowEditModal(null), className: "text-slate-300 hover:text-red-500 transition-all" }, React.createElement(X, { className: "w-8 h-8" }))),
                        React.createElement('form', { onSubmit: (e) => { e.preventDefault(); handleAction('edit', [], { id: showEditModal.id, ...showEditModal }); }, className: "space-y-4 text-sm" },
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Název materiálu"), React.createElement('input', { value: showEditModal.nazev, onChange: e => setShowEditModal({...showEditModal, nazev: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                            React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Popisek / Poznámka"), React.createElement('textarea', { value: showEditModal.poznamka, onChange: e => setShowEditModal({...showEditModal, poznamka: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl h-24 outline-none focus:ring-2 focus:ring-blue-600 transition-all" })),
                             React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Třída"),
                                    React.createElement('select', { value: showEditModal.trida, onChange: e => setShowEditModal({...showEditModal, trida: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                        uniqueGrades.filter(g => g !== 'Vše').map(g => React.createElement('option', { key: g }, g))
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Předmět"),
                                    React.createElement('select', { value: showEditModal.predmet, onChange: e => setShowEditModal({...showEditModal, predmet: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                         uniqueSubjects.filter(s => s !== 'Vše').map(s => React.createElement('option', { key: s }, s))
                                    )
                                )
                            ),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Typ materiálu"),
                                    React.createElement('select', { value: showEditModal.typ, onChange: e => setShowEditModal({...showEditModal, typ: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-600" },
                                        data.config.filter(c => c.kategorie === 'Typ').map(t => React.createElement('option', { key: t.nazev }, t.nazev))
                                    )
                                ),
                                React.createElement('div', null, React.createElement('label', { className: "text-[10px] font-bold uppercase text-slate-400 ml-2 block mb-1" }, "Tagy (#...)"), React.createElement('input', { value: showEditModal.tagy, onChange: e => setShowEditModal({...showEditModal, tagy: e.target.value}), className: "w-full p-4 bg-slate-50 border rounded-2xl text-sm outline-none" }))
                            ),
                            React.createElement('button', { className: "w-full bg-blue-600 text-white py-5 rounded-[2rem] font-bold uppercase shadow-xl hover:bg-blue-700 transition-all mt-4" }, "Uložit změny")
                        )
                    )
                )
            );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(React.createElement(App));
    </script>
</body>
</html>
